<template name="instructorReporting">
  <style>
    /* Chrome, Safari, Edge, Opera */
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  
  /* Firefox */
  input[type=number] {
    -moz-appearance: textfield;
  }
  </style>
{{#if isInRole 'admin, teacher'}}
  <div class="container" style="margin-top: 1rem;">
    <h3 style="margin-top: 0; text-align: center;">Instructor Reporting</h3>

    <div id="mainContent">
      <div class="admin-section" style="margin-top: 0;">
        <h4 class="text-center">Class Selection</h4>
        <select id="class-select" class="w-75 mx-auto d-block">
          <option selected="selected" value="{{INVALID}}" disabled="true">Select a class</option>
          {{#each classes}}
            <option value="{{this._id}}">{{this.courseName}}</option>
          {{/each}}
        </select>
      </div>
      <div class="admin-section">
        <h4 class="text-center">Select Chapter</h4>
        <select id="tdf-select" disabled="true" class="w-75 mx-auto d-block">
            <option selected="selected" value="{{INVALID}}" disabled="true">Select a lesson</option>
            {{#each curInstructorReportingTdfs}}
              <option value="{{this.TDFId}}">{{this.displayName}}</option>
            {{/each}}
        </select>
        {{#if performanceLoading}}
          <p>Loading reports...</p>
        {{/if}}
      </div>
      {{#if selectedTdfDueDate}}
      <div class="admin-section">
        <h4 class="text-center">Practice Deadline</h4>
        <input type="date" id="practice-deadline-date" name="practice-deadline-date-select" disabled="true" class="w-75 mx-auto d-block">
      </div>
      <div class="admin-section">
        <h4 class="text-center">Filter By Due Date ({{selectedTdfDueDate}})</h4>
        Enabled: <input type="checkbox" id="due-date-filter" name="due-date-filter-select"><br>
        Exception Date: <input type="date" id="exception-date" name="exception-date-select">
      </div>
      {{/if}}
      <div class="admin-section">
        <h4 class="text-center">Class Data</h4>
      <div class="admin-table-wrapper">
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Student</th>
                <th>% Correct</th>
                <th>Count</th>
                <th>Total Time (min)</th>
                <th>Exceptions</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
          {{#if dueDateFilter}}
          <tr>
            <td colspan="6" style="font-weight: 600; background-color: rgba(0, 0, 0, 0.05);">
              Completed Before Due Date
            </td>
          </tr>
          {{/if}}
          {{#if curClassStudentPerformance}}
            {{#each curClassStudentPerformance}}
              <tr id="{{this.userId}}">
                <td><a onclick="navigateToStudentReporting('{{this.username}}')">{{this.username}}</a></td>
                <td>{{this.percentCorrect}}</td>
                <td>{{this.count}}</td>
                <td>{{this.totalTimeMins}}</td>
                <td>
                  {{#if this.exception}}
                    {{this.exception}}
                  {{/if}}
                </td>
                <td>
                {{#if this.exception}}
                  <a data-userid="{{this.userId}}" id="remove-exception">Remove Exception</a>
                {{else}}
                {{/if}}
                </td>
              </tr>
            {{/each}}
          {{else}}
            <tr><td colspan="6">No data available</td></tr>
          {{/if}}
          {{#if dueDateFilter}}
          <tr>
            <td colspan="6" style="font-weight: 600; background-color: rgba(0, 0, 0, 0.05);">
              Completed After Due Date
            </td>
          </tr>
            {{#if curClassStudentPerformanceAfterFilter}}
              {{#each curClassStudentPerformanceAfterFilter}}
              <tr>
                <td><a onclick="navigateToStudentReporting('{{this.username}}')">{{this.username}}</a></td>
                <td>{{this.percentCorrect}}</td>
                <td>{{this.count}}</td>
                <td>{{this.totalTimeMins}}</td>
                <td>
                  {{#if this.exception}}
                    <span style="color: red">{{this.exception}}</span>
                  {{/if}}
                </td>
                <td>
                  {{#if this.exception}}
                    <a data-userid="{{this.userId}}" id="remove-exception">Remove Exception</a>
                  {{else}}
                    <a data-userid="{{this.userId}}" id="add-exception">Add Exception</a>
                  {{/if}}
                </td>
              </tr>
              {{/each}}
            {{else}}
              <tr><td colspan="6">No data available</td></tr>
            {{/if}}
          {{/if}}
            </tbody>
          <tfoot id="classReportingTotal">
            <tr>
              <td>Totals</td>
              <td>{{curClassPerformance.percentCorrect}}</td>
              <td>{{curClassPerformance.count}}</td>
              <td>{{curClassPerformance.totalTimeMins}}</td>
              <td></td>
              <td></td>
            </tr>
          </tfoot>
          </table>
        </div>
      </div>
      </div>
    </div>
  </div>
{{/if}}

</template>
