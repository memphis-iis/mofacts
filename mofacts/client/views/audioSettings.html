<template name="audioSettings">
  <div class="container-fluid main-content-container">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-8">
        <!-- Page Header -->
        <div class="mb-4">
          <h2 class="text-center mb-0">Audio Settings</h2>
        </div>

        <div class="p-4">
          <!-- Text-to-Speech Section -->
          <section class="mb-4">
            <div class="d-flex align-items-center mb-3">
              <i class="fa fa-headphones text-primary me-2" style="font-size: 1.25rem;"></i>
              <h5 class="mb-0">Text-to-Speech</h5>
            </div>
            <p class="text-muted small mb-3">Choose what {{currentTheme.properties.themeName}} reads aloud during practice.</p>

            <div class="card border">
              <div class="card-body">
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" role="switch" id="audioPromptQuestionOn">
                  <label class="form-check-label ms-2" for="audioPromptQuestionOn">
                    <strong>Read questions</strong>
                    <br><small class="text-muted">Hear each question read aloud</small>
                  </label>
                </div>

                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="audioPromptFeedbackOn">
                  <label class="form-check-label ms-2" for="audioPromptFeedbackOn">
                    <strong>Read feedback</strong>
                    <br><small class="text-muted">Hear feedback after your answer</small>
                  </label>
                </div>
              </div>
            </div>
          </section>

          <!-- Voice Controls (shown when TTS is enabled) -->
          <div class="audioPromptSharedGroup" style="display: none;">
            <div class="card border bg-light">
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-4">
                    <label for="audioPromptVolume" class="form-label fw-semibold">
                      <i class="fa fa-volume-up me-1"></i>Volume
                    </label>
                    <input type="range" class="form-range" id="audioPromptVolume" min="-6" max="6" step=".5" value="0">
                    <div class="d-flex justify-content-between">
                      <small class="text-muted">Quieter</small>
                      <small class="text-muted">Louder</small>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <label for="audioPromptSpeakingRate" class="form-label fw-semibold">
                      <i class="fa fa-gauge me-1"></i>Speed
                    </label>
                    <select class="form-select" id="audioPromptSpeakingRate">
                      <option value=".25">0.25x</option>
                      <option value=".5">0.50x</option>
                      <option value=".75">0.75x</option>
                      <option value="1" selected>Normal</option>
                      <option value="1.25">1.25x</option>
                      <option value="1.5">1.50x</option>
                      <option value="1.75">1.75x</option>
                      <option value="2">2.00x</option>
                    </select>
                  </div>

                  <div class="col-md-4">
                    <label for="audioPromptVoice" class="form-label fw-semibold">
                      <i class="fa fa-user me-1"></i>Voice
                    </label>
                    <div class="input-group">
                      <select class="form-select" id="audioPromptVoice">
                        <option value="en-US-Standard-A" selected>Male 1</option>
                        <option value="en-US-Standard-B">Male 2</option>
                        <option value="en-US-Standard-C">Female 1</option>
                        <option value="en-US-Standard-D">Male 3</option>
                        <option value="en-US-Standard-E">Female 2</option>
                        <option value="en-US-Standard-F">Female 3</option>
                        <option value="en-US-Standard-G">Female 4</option>
                        <option value="en-US-Standard-H">Female 5</option>
                        <option value="en-US-Standard-I">Male 4</option>
                        <option value="en-US-Standard-J">Male 5</option>
                      </select>
                      <button class="btn btn-outline-secondary" type="button" id="audioPromptVoiceTest" title="Test voice">
                        <i class="fa fa-play"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Speech Recognition Section -->
          <section class="mb-4 mt-5">
            <div class="d-flex align-items-center mb-3">
              <i class="fa fa-microphone text-danger me-2" style="font-size: 1.25rem;"></i>
              <h5 class="mb-0">Speech Recognition</h5>
            </div>
            <p class="text-muted small mb-3">Speak your answers instead of typing them.</p>

            <div class="card border">
              <div class="card-body">
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" role="switch" id="audioInputOn">
                  <label class="form-check-label ms-2" for="audioInputOn">
                    <strong>Enable voice input</strong>
                    <br><small class="text-muted">Answer questions by speaking</small>
                  </label>
                </div>

                <div class="audioInputGroup" style="display: none;">
                  <label for="audioInputSensitivity" class="form-label fw-semibold">
                    <i class="fa fa-sliders me-1"></i>Microphone Sensitivity
                  </label>
                  <input type="range" class="form-range" id="audioInputSensitivity" value="60" step="1" min="0" max="100">
                  <div class="d-flex justify-content-between">
                    <small class="text-muted">Noisy Room</small>
                    <small class="text-muted">Quiet Room</small>
                  </div>

                  {{#if showSpeechAPISetup}}
                    <div class="mt-3">
                      {{#if speechAPIKeyIsSetup}}
                        <div class="alert alert-success border-success mb-0" role="alert">
                          <i class="fa fa-check-circle"></i> Speech API key configured
                        </div>
                      {{else}}
                        <div class="alert alert-warning border-warning mb-0" role="alert">
                          <i class="fa fa-exclamation-triangle"></i> Speech API key not configured.
                          <a href="#" id="setupAPIKey" class="alert-link">Click here to set up</a>
                        </div>
                      {{/if}}
                    </div>
                  {{/if}}
                </div>
              </div>
            </div>
          </section>

        </div>
      </div>
    </div>
  </div>
</template>

<!-- Speech API Key Setup Modal (separate from audio settings) -->
<template name="speechAPIModal">
  <div class="modal fade" id="speechAPIModal" tabindex="-1" aria-labelledby="speechAPIModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-bottom">
          <h5 class="modal-title" id="speechAPIModalLabel">
            <i class="fa fa-key me-2"></i>Speech API Key Setup
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted">To use speech recognition, you need a Google Speech API key.</p>
          <p>
            <strong>Instructions:</strong> Enable the Google Speech API and generate an API key by following
            <a href="https://support.google.com/cloud/answer/6158862?hl=en" target="_blank" class="alert-link">these instructions <i class="fa fa-external-link-alt fa-sm"></i></a>.
          </p>
          <div class="mt-3">
            <label for="speechAPIKey" class="form-label fw-semibold">Google Speech API Key:</label>
            <input type="text" class="form-control" id="speechAPIKey" placeholder="Enter your API key">
          </div>
        </div>
        <div class="modal-footer border-top">
          <button id="speechAPIDelete" type="button" class="btn btn-outline-danger me-auto">
            <i class="fa fa-trash"></i> Delete Key
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="speechAPISubmit" type="button" class="btn btn-primary">
            <i class="fa fa-save"></i> Save Key
          </button>
        </div>
      </div>
    </div>
  </div>
</template>
