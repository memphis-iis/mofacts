{"version":3,"sources":["/tools/cli/commands-packages-query.js"],"names":["loadIsopackage","module","link","v","_","require","buildmessage","catalog","Console","files","main","packageVersionParser","projectContextModule","utils","catalogUtils","compiler","DEFAULT_MAX_AGE_MS","MAX_RECENT_VERSIONS","getReleaseVersionPublishedOn","versionRecord","published","Date","toolPackage","tool","split","toolName","toolVersion","toolRecord","official","getVersion","formatHiddenVersions","hiddenVersions","oldestShownVersion","reasons","lastUnmigrated","push","lastPreRelease","lessThan","oldestVersion","length","slice","join","last","formatEJSON","data","EJSON","stringify","indent","padLongformDate","dateStr","numSpaces","maxDateLength","Array","getTempContext","options","projectContext","appDir","ProjectContext","projectDir","currentPackageDir","packageDir","tempProjectDir","mkdtemp","explicitlyAddedLocalPackageDirs","captureAndExit","initializeCatalog","itemNotFound","item","error","explainIfRefreshFailed","BasePkgDatum","self","extend","prototype","_checkInitialized","Error","isEmpty","getObject","getConsoleStr","PkgExports","pkgExports","map","exp","arches","architectures","indexOf","without","sort","name","sortBy","strExports","ALL_ARCHES","noWrap","PkgImplies","pkgDeps","each","ref","references","r","implied","archName","arch","strImplies","PkgDependencies","omit","dep","depName","weak","every","constraint","strDeps","depString","PackageQuery","metaRecord","localCatalog","showArchitecturesOS","showDependencies","showHiddenVersions","version","_getVersionRecord","local","_getLocalVersion","_getOfficialVersion","_collectPackageData","getLatestVersion","print","ejson","rawInfo","_generateVersionObject","_generatePackageObject","_displayVersion","_displayPackage","maintainers","pluck","homepage","serverVersionRecords","getSortedVersionRecords","totalVersions","filteredVersionRecords","filter","vr","unmigrated","localVersion","summary","description","git","implies","exports","mainlineRecord","getLatestMainlineVersion","dependencies","longDescription","versions","publishedBy","username","publishedOn","allBuilds","getAllBuilds","build","archOS","buildArchitectures","tropohouse","installed","packageName","e","printError","localRecord","packageSource","getPackageSource","sourceRoot","getExports","versionExplicitlyProvided","readmeInfo","processReadme","excerpt","info","bulletPoint","directory","path","url","publisher","pubDate","longformDate","command","versionFields","processedData","key","pick","defaultVersion","displayName","printDescription","versionRows","versionsHeader","publishDate","paddedDate","printTwoColumns","ignoreWidth","hiddenVersionsPluralizer","toUpperCase","allVersionsPluralizer","packageFields","ReleaseQuery","_getVersionDetails","_getReleaseData","fields","_displayRelease","getReleaseVersion","track","recommended","orderKey","pubishedOn","packages","getDefaultReleaseVersionRecord","getReleaseVersionRecords","getSortedRecommendedReleaseRecords","reverse","getNumReleaseVersions","isRecommended","_displayAllReleaseVersions","rows","versionsPluralizer","versionsHidden","columnOpts","versionsDivided","groupBy","has","experimentalVersions","versionsWithKey","registerCommand","pretty","minArgs","maxArgs","usesPackage","type","Boolean","catalogRefresh","Refresh","OnceAtStart","maxAge","ignoreErrors","fullName","args","splitArgs","process","exit","currentVersion","getVersionBySourceRoot","query","packageRecord","getPackage","releaseRecord","getReleaseTrack","maintainer","String","allPackages","union","getAllPackageNames","allReleases","getAllReleaseTracks","matchingPackages","matchingReleases","selector","pattern","search","RegExp","err","filterBroken","match","isRelease","projectCatalog","debugOnly","prodOnly","testOnly","record","findWhere","enterJob","title","pack","latestVersion","lastUpdated","ret","releases","output","isEqual","printPackageList"],"mappings":"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","sourcesContent":["// These commands deal with aggregating local package data with the information\n// contained in the Meteor Package Server. They also deal with presenting this\n// to the user in various human or machine-readable ways.\nvar _ = require('underscore');\nvar buildmessage = require('../utils/buildmessage.js');\nvar catalog = require('../packaging/catalog/catalog.js');\nvar Console = require('../console/console.js').Console;\nvar files = require('../fs/files');\nimport { loadIsopackage } from '../tool-env/isopackets.js';\nvar main = require('./main.js');\nvar packageVersionParser = require('../packaging/package-version-parser.js');\nvar projectContextModule = require('../project-context.js');\nvar utils = require('../utils/utils.js');\nvar catalogUtils = require('../packaging/catalog/catalog-utils.js');\nvar compiler = require('../isobuild/compiler.js');\n\n// We want these queries to be relatively fast, so we will only refresh the\n// catalog if it is > 15 minutes old\nvar DEFAULT_MAX_AGE_MS = 15 * 60 * 1000;\n\n// Maximum number of recent versions of a package or a release that we should\n// return to the user, unless a more complete mode is requested.\nvar MAX_RECENT_VERSIONS = 5;\n\n// XXX: Remove this if/when we do a Troposphere migration to backfill release\n// version publication times.\n// Estimate the publication date for a release. Since we have failed to keep\n// track of publication times of release versions in the past, we will try to\n// guess that the release was published at the same time as the tool.\nvar getReleaseVersionPublishedOn = function (versionRecord) {\n  if (versionRecord.published) {\n    return new Date(versionRecord.published);\n  }\n  // We don't know when the release was published. Luckily, since there is no\n  // way to use the tool outside of a release, and we always change the tool\n  // between releases, it is a good bet that the release was published on the\n  // same day as the tool.\n  var toolPackage = versionRecord.tool.split('@');\n  var toolName = toolPackage[0];\n  var toolVersion = toolPackage[1];\n  var toolRecord = catalog.official.getVersion(toolName, toolVersion);\n  if (! toolRecord || ! toolRecord.published) {\n    return null;\n  }\n  return new Date(toolRecord.published);\n};\n\n// Processes information about the versions that we hid. Returns a brief\n// human-friendly string listing the reasons why some versions of the package\n// were not shown.\nvar formatHiddenVersions = function (hiddenVersions, oldestShownVersion) {\n  // An array of strings, listing the reasons why some versions were hidden.\n  var reasons = [];\n  // Use our information about hidden versions to figure what reasons we\n  // actually want to return to the user.\n  if (! oldestShownVersion) {\n    // We did not show any versions, so presumably all existing versions of\n    // this package are either unmigrated or pre-release versions.\n    if (hiddenVersions.lastUnmigrated) {\n      reasons.push(\"unmigrated\");\n    }\n    if (hiddenVersions.lastPreRelease) {\n      reasons.push(\"pre-release\");\n    }\n  } else {\n    // If the oldest version on record is older than the oldest shown\n    // version, then it was hidden due to MAX_RECENT_VERSION number. (It\n    // might also be hidden because it is a pre-release or unmigrated, but\n    // age takes priority).\n    if (packageVersionParser.lessThan(\n        hiddenVersions.oldestVersion, oldestShownVersion)) {\n      reasons.push(\"older\");\n    }\n\n    // If the latest unmigrated/pre-release version is older than the oldest\n    // version that we are showing, then we don't care about it. If it is\n    // younger, we need to tell the user.\n    //\n    // It is certainly possible that, even though a pre-release version is older\n    // than the oldest version that we are showing, but under the limit for the\n    // MAX_RECENT_VERSIONS. So, in that case, we are eliding that version\n    // because it is a pre-release, not because of age. It is still,\n    // technically, an 'older' version though, and that explanation is more\n    // intuitive.\n    if (hiddenVersions.lastPreRelease &&\n        packageVersionParser.lessThan(\n          oldestShownVersion, hiddenVersions.lastPreRelease)) {\n      reasons.push(\"pre-release\");\n    }\n    if (hiddenVersions.lastUnmigrated &&\n        packageVersionParser.lessThan(\n          oldestShownVersion, hiddenVersions.lastUnmigrated)) {\n      reasons.push(\"unmigrated\");\n    }\n  }\n\n  // Now, we will aggregate the reasons into a human-readable string.\n  if (reasons.length === 1) {\n    return reasons[0];\n  } else if (reasons.length === 2) {\n    // There is no oxford comma if only listing two objects\n    return reasons[0] + \" and \" + reasons[1];\n  } else if (reasons.length > 2)  {\n    return reasons.slice(0, -1).join(\", \") + \", and \" + _.last(reasons);\n  } else {\n    // Did we not figure out anything to write? Did something else go wrong?\n    // This should never happen, but if it does, recover by omitting\n    // information.\n    return \"Some\";\n  }\n};\n\n// Converts an object to an EJSON string with the right spacing.\nfunction formatEJSON(data) {\n  const { EJSON } = loadIsopackage('ejson');\n  return EJSON.stringify(data, { indent: true }) + \"\\n\";\n}\n\n// Takes in a string and pads it with whitespace to the length of the longest\n// possible date string.\nvar padLongformDate = function (dateStr) {\n  var numSpaces = utils.maxDateLength - dateStr.length;\n  return dateStr + Array(numSpaces + 1).join(' ');\n};\n\n// In order to get access to local package data, we need to create a local\n// package catalog. The best way to do that is to create a temporary\n// ProjectContext and let it handle catalog initialization. When we do, we need\n// to make sure that it is aware of all the local packages that we might care\n// about.\n//\n// This function returns such a ProjectContext, and takes in the following\n// options:\n//  - appDir: If we are running in the context of an app, this will contain the\n//    root of the app. We want to make sure to grab the data from the app's\n//    local packages.\n//  - packageDir: If we are running in a package directory, this will contain\n//    the source root of that package. If we are running from inside a package,\n//    we want that package to show up in our results.\nvar getTempContext = function (options) {\n  var projectContext;\n  // If we are running in an app, we will use it to create a\n  // (mostly immutable) projectContext.\n  if (options.appDir) {\n    projectContext = new projectContextModule.ProjectContext({\n      projectDir: options.appDir\n    });\n  } else {\n    // We're not in an app, so we will create a temporary app and use it to load\n    // the local catalog. If a local packageDir exists, include it manually.\n    var currentPackageDir = options.packageDir ? [options.packageDir] : [];\n    var tempProjectDir = files.mkdtemp('meteor-show');\n    projectContext = new projectContextModule.ProjectContext({\n      projectDir: tempProjectDir,\n      explicitlyAddedLocalPackageDirs: currentPackageDir\n    });\n  }\n\n  // It is possible that we can't process package.js files in our local packages\n  // and have to exit early. This is unfortunate, but we can't search local\n  // packages if we can't read them. If this turns out to be a frequent problem,\n  // we can give a warning, instead of failing in the future. For now, we want\n  // to err on the side of consistency.\n  main.captureAndExit(\"=> Errors while reading local packages:\", function () {\n    projectContext.initializeCatalog();\n  });\n  return projectContext;\n};\n\n// Print an error message if the user asks about an unknown item.\nvar itemNotFound = function (item) {\n  Console.error(item + \": not found\");\n  catalogUtils.explainIfRefreshFailed();\n  return 1;\n};\n\n// This is a base class for storing package fields that require some processing\n// to store and display correctly.\n//\n// Do NOT initialize this class by itself -- use one of the classes that\n// inherits from it.\nvar BasePkgDatum = function () {\n  var self = this;\n  self.data = null;\n};\n_.extend(BasePkgDatum.prototype, {\n  // Throws if data has not been initialized.\n  _checkInitialized: function () {\n    var self = this;\n    if (self.data === null) {\n      throw new Error(\"do not use the BasePkgDatum class by itself\");\n    }\n  },\n  // Returns true if this class does not contain any exports.\n  isEmpty : function () {\n    var self = this;\n    self._checkInitialized();\n    return _.isEmpty(self.data);\n  },\n  // Get exports as a raw object.\n  getObject : function () {\n    var self = this;\n    self._checkInitialized();\n    return self.data;\n  },\n  getConsoleStr : function () {\n    var self = this;\n    self._checkInitialized();\n    return \"\";\n  }\n});\n\n// This class stores exports from a given package.\n//\n// Stores exports for a given package and returns them to the caller in a given\n// format. Takes in the raw exports from the package.\nvar PkgExports = function (pkgExports) {\n var self = this;\n // Process and save the export data.\n self.data = _.map(pkgExports, function (exp) {\n    var arches = exp.architectures;\n    // Replace 'os' (what we store) with 'server' (what you would put in a\n    // package.js file). That's more user friendly, and avoids confusing this\n    // with different OS arches used in binary packages.\n    if ( _.indexOf(arches, \"os\") !== -1) {\n      arches = _.without(arches, \"os\");\n      arches.push(\"server\");\n    }\n    // Sort architectures alphabetically.\n    arches.sort();\n    return { name: exp.name, architectures: arches };\n  });\n  // Sort exports alphabetically by name.\n  self.data =  _.sortBy(self.data, \"name\");\n};\n// Extend BasePkgDatum.\nPkgExports.prototype = new BasePkgDatum();\n\n_.extend(PkgExports.prototype, {\n  // Convert package exports into a pretty, Console non-wrappable string. If an\n  // export is only declared for certain architectures, mentions those\n  // architectures in a user-friendly format.\n  getConsoleStr: function () {\n    var self = this;\n    var strExports = _.map(self.data, function (exp) {\n      // If this export is valid for all architectures, don't specify\n      // architectures here.\n      if (exp.architectures.length === compiler.ALL_ARCHES.length) {\n        return exp.name;\n      }\n\n      // Don't split descriptions of individual pkgExports between lines.\n      return Console.noWrap(\n        exp.name + \" (\" + exp.architectures.join(\", \") + \")\");\n    });\n    return strExports.join(\", \");\n  }\n});\n\n// This class stores implies from a given package.\n//\n// Stores implies for a given package and returns them to the caller in a given\n// format. Takes in the dependencies from the package.\nvar PkgImplies = function (pkgDeps) {\n  var self = this;\n  self.data = [];\n  // Go through all the package dependencies. If a dependency has any implied\n  // references, add it to the list.\n  _.each(pkgDeps, function (ref, name) {\n    var architectures = [];\n    // We want to select the references that are implied (instead of just used)\n    // and save their architectures. Also, we want to replace 'os' with\n    // 'server', as with exports.\n    _.each(ref.references, function (r) {\n      if (! r.implied) {\n        return;\n      }\n      var archName = (r.arch === \"os\") ? \"server\" : r.arch;\n      architectures.push(archName);\n    });\n    // Sort architecures alphabetically.\n    architectures.sort();\n    if (! _.isEmpty(architectures)) {\n      self.data.push({ name: name, architectures: architectures });\n    }\n  });\n  // Sort by name.\n  self.data =  _.sortBy(self.data, \"name\");\n};\n\n// Extend BasePkgDatum.\nPkgImplies.prototype = new BasePkgDatum();\n\n_.extend(PkgImplies.prototype, {\n  // Convert package exports into a pretty, Console non-wrappable string. If an\n  // export is only declared for certain architectures, mentions those\n  // architectures in a user-friendly format.\n  getConsoleStr: function () {\n    var self = this;\n    var strImplies = _.map(self.data, function (ref) {\n      // If an imply is valid for all architectures, don't specify it here.\n      if (ref[\"architectures\"].length === compiler.ALL_ARCHES.length) {\n        return ref.name;\n      }\n\n      // Don't split descriptions of individual implies between lines.\n      return Console.noWrap(\n        ref.name + \" (\" + ref.architectures.join(\", \") + \")\");\n    });\n    return strImplies.join(\", \");\n  }\n});\n\n// This class stores dependencies from a given package.\n//\n// Stores dependencies for a given package and returns them to the caller in a given\n// format. Takes in the raw dependencies from the package record.\nvar PkgDependencies = function (pkgDeps) {\n  var self = this;\n  self.data = _.map(\n    // The dependency on 'meteor' was almost certainly added automatically, by\n    // Isobuild. Returning this to the user will only cause confusion.\n    _.omit(pkgDeps, \"meteor\"),\n    function (dep, depName) {\n      // We will only consider this a weak dependency if all of its references\n      // are marked as weak.\n      var weak = _.every(dep.references, function (ref) {\n        return !! ref.weak;\n      });\n      return {\n        name: depName,\n        constraint: dep.constraint,\n        weak: weak\n      };\n  });\n  // Sort by name.\n  self.data =  _.sortBy(self.data, \"name\");\n};\n\n// Extend BasePkgDatum.\nPkgDependencies.prototype = new BasePkgDatum();\n\n_.extend(PkgDependencies.prototype, {\n  // Convert package exports into a pretty, Console non-wrappable string. If an\n  // export is only declared for certain architectures, mentions those\n  // architectures in a user-friendly format.\n  getConsoleStr: function () {\n    var self = this;\n    var strDeps = _.map(self.data, function (dep) {\n      var depString = dep.name;\n      if (dep.constraint && dep.constraint !== null) {\n        depString += \"@\" + dep.constraint;\n      }\n      if (dep.weak) {\n        depString += \" (weak dependency)\";\n      }\n      return Console.noWrap(depString);\n    });\n    return strDeps.join(\"\\n\");\n  }\n});\n\n\n// The two classes below collect and print relevant information about Meteor\n// packages and Meteor releases, respectively. Specifically, they query the\n// official catalog and, if applicable, relevant local sources. They also handle\n// the details of printing their data to the screen.\n//\n// A query class has:\n//  - data: an object representing the data it has collected in response to the\n//  - query.\n//  - a print method, that take options as an argument and prints the results to\n//    the terminal.\n\n\n// This class deals with information related to packages. To deal with local\n// packages, it has to interact with the projectContext.\n//\n// The constructor takes in the following options:\n//   - metaRecord: (mandatory) the meta-record for this package from the Packages\n//     collection.\n//   - projectContext: (mandatory) a projectContext that we can use to look up\n//     information on local packages.\n//   - version: query for a specific version of this package.\n//   - showArchitecturesOS: collect and process data on OS\n//     architectures that are available for different versions of this package.\n//   - showHiddenVersions: return information about all the versions of the\n//     package, including pre-releases and unmigrated versions.\n//   - showDependencies: return information about\n//     versions' dependencies.\nvar PackageQuery = function (options) {\n  var self = this;\n\n  // This is the record in the packages collection. It contains things like\n  // maintainers, and the package homepage.\n  self.metaRecord = options.metaRecord;\n  self.name = options.metaRecord.name;\n\n  // This argument is required -- we use it to look up data. If it has not been\n  // passed in, fail early.\n  if (! options.projectContext) {\n    throw Error(\"Missing required argument: projectContext\");\n  }\n  self.projectContext = options.projectContext;\n  self.localCatalog = options.projectContext.localCatalog;\n\n  // Processing per-version availability architectures & dependencies is\n  // expensive, so we don't do it unless we are asked to.\n  self.showArchitecturesOS = options.showArchitecturesOS;\n  self.showDependencies = options.showDependencies;\n\n  // We don't want to show pre-releases and un-migrated versions to the user\n  // unless they explicitly ask us about it.\n  self.showHiddenVersions = options.showHiddenVersions;\n\n  // Collect the data for this package, including looking up any specific\n  // package version that we care about.\n  if (options.version) {\n    var versionRecord = self._getVersionRecord(options.version);\n    if (! versionRecord) {\n      self.data = null;\n      return;\n    }\n    self.data =  versionRecord.local ?\n      self._getLocalVersion(versionRecord) :\n      self._getOfficialVersion(versionRecord);\n  } else {\n    self.data = self._collectPackageData();\n  }\n};\n\n_.extend(PackageQuery.prototype, {\n  // Find and return a version record for a given version. Mark the version\n  // record as local, if it is a local version of the package.\n  _getVersionRecord: function (version) {\n    var self = this;\n\n    // We allow local version to override remote versions in meteor show, so we\n    // should start by checking if this is a local version first.\n    var versionRecord = self.localCatalog.getLatestVersion(self.name);\n\n    // If we asked for \"local\" as the version number, and found any local version\n    // at all, we are done.\n    if (version === \"local\") {\n      return versionRecord && _.extend(versionRecord, { local: true });\n    }\n\n    // We have a local record, and its version matches the version that we asked\n    // for, so we are done.\n    if (versionRecord && (versionRecord.version === version)) {\n      return _.extend(versionRecord, { local: true });\n    }\n\n    // If we haven't found a local record, or if the local record that we found\n    // doesn't match the version that we asked for, then we have to go look in\n    // the server catalog.\n    versionRecord = catalog.official.getVersion(self.name, version);\n    return versionRecord;\n  },\n  // Print the query information to screen.\n  //\n  // options:\n  //   - ejson: Don't pretty-print the data. Print a machine-readable ejson\n  //     object.\n  print: function (options) {\n    var self = this;\n\n    // If we are asking for an EJSON-style output, we will only print out the\n    // relevant fields.\n    if (options.ejson) {\n      Console.rawInfo(formatEJSON(\n        self.data.version ?\n          self._generateVersionObject(self.data) :\n          self._generatePackageObject(self.data)));\n      return;\n    }\n\n    // Otherwise, display the information that we have. If we were asking about\n    // a specific version, display that. Otherwise, display package metadata in\n    // general.\n    if (self.data.version) {\n      self._displayVersion(self.data);\n      return;\n    }\n    self._displayPackage(self.data);\n  },\n  // Aggregates data about the package as a whole. Returns an object with the\n  // following keys:\n  //\n  // - name: package name\n  // - maintainers: an array of usernames of maintainers\n  // - homepage: string homepage\n  // - totalVersions: total number of versions that this package has, including\n  //   local and hidden versions.\n  // - defaultVersion: a default version: use this version to look up\n  //   per-version information that is relevant to the package as a whole, such\n  //   as git, description,etc.\n  // - versions: an array of objects representing versions of this package.\n  _collectPackageData: function () {\n    var self = this;\n    var data = {\n      name: self.metaRecord.name,\n      maintainers: _.pluck(self.metaRecord.maintainers, \"username\"),\n      homepage: self.metaRecord.homepage\n    };\n\n    // Collect surface information about available versions, starting with the\n    // versions available on the server.\n    var serverVersionRecords =\n          catalog.official.getSortedVersionRecords(self.name);\n    var totalVersions = serverVersionRecords.length;\n\n    // If we are not going to show hidden versions, then we shouldn't waste time\n    // on them. Trim the serverVersionRecords array to only have the top\n    // MAX_RECENT_VERSIONS migrated, official versions.\n    if (! self.showHiddenVersions) {\n      // We might have to hide some versions from the user. We want to explain\n      // why we hid them. Here is how we are going to explain things -- any\n      // versions older than the oldest version that we show, are hidden because\n      // of age. If, in the covered time period, there are\n      // unmigrated/pre-release versions, then we will mention those  as well.\n      //\n      // Specifically, while we filter versions, we are going to memorize the\n      // most recent version hidden for a specific reason.\n      var lastUnmigrated = \"\";\n      var lastPreRelease = \"\";\n      var oldestVersion =\n        serverVersionRecords[0] && serverVersionRecords[0].version;\n      var filteredVersionRecords =\n        _.filter(serverVersionRecords, function (vr) {\n          if (vr.unmigrated) {\n            lastUnmigrated = vr.version;\n            return false;\n          }\n\n          if (vr.version.indexOf(\"-\") !== -1) {\n            lastPreRelease = vr.version;\n            return false;\n          }\n          return true;\n        });\n     serverVersionRecords = _.last(filteredVersionRecords, MAX_RECENT_VERSIONS);\n     data[\"hiddenVersions\"] = {\n       oldestVersion: oldestVersion,\n       lastUnmigrated: lastUnmigrated,\n       lastPreRelease: lastPreRelease\n     };\n    };\n\n    // Process the catalog records into our preferred format, and look up any\n    // other per-version information that we might need.\n    data[\"versions\"] = _.map(serverVersionRecords, function (versionRecord) {\n      return self._getOfficialVersion(versionRecord);\n    });\n\n    // The local version doesn't count against the version limit. Look up relevant\n    // information about the local version.\n    var localVersion = self.localCatalog.getLatestVersion(self.name);\n    var local;\n    if (localVersion) {\n      local = self._getLocalVersion(localVersion);\n      data[\"versions\"].push(local);\n      totalVersions++;\n    }\n\n    // Record the total number of versions, including the ones we hid from the\n    // user.\n    data[\"totalVersions\"] = totalVersions;\n\n    // Some per-version information gets displayed with the rest of the package\n    // information.  We want to use the right version for that. (We don't want\n    // to display data from unofficial or un-migrated versions just because they\n    // are recent.)\n    if (local) {\n      data[\"defaultVersion\"] = {\n        version: \"local\",\n        summary: local.summary,\n        description: local.description,\n        git: local.git,\n        implies: local.implies,\n        exports: local.exports\n      };\n    } else {\n      var mainlineRecord = catalog.official.getLatestMainlineVersion(self.name);\n      if (mainlineRecord) {\n        var pkgExports = new PkgExports(mainlineRecord.exports);\n        var implies = new PkgImplies(mainlineRecord.dependencies);\n        data[\"defaultVersion\"] = {\n          version: mainlineRecord.version,\n          summary: mainlineRecord.description,\n          description: mainlineRecord.longDescription,\n          git: mainlineRecord.git,\n          exports: pkgExports,\n          implies: implies\n        };\n      } else {\n        data[\"defaultVersion\"] = _.last(data.versions);\n      }\n    }\n    return data;\n  },\n  // Takes in a version record from the official catalog and looks up extra\n  // information that's relevant to this PackageQuery.\n  //\n  // - name: package Name\n  // - version: package version\n  // - summary: version summary/short description (from Package.describe)\n  // - description: long-form description (from the README.md)\n  // - publishedBy: username of the publisher\n  // - publishedOn: date of publication\n  // - git: git URL for this version\n  // - installed: true if the package exists in warehouse, and is therefore\n  //   available for use offline.\n  // - architectures: (optional) if self.showArchitecturesOS is true, returns an\n  //   array of system architectures for which that package is available.\n  // - dependencies: (optional) if self.showDependencies is true, return an\n  //   array of objects denoting that package's dependencies. The objects have\n  //   the following keys:\n  //     - packageName: name of the dependency\n  //     - constraint: constraint for that dependency\n  //     - weak: true if this is a weak dependency.\n  _getOfficialVersion: function (versionRecord) {\n    var self = this;\n    var version = versionRecord.version;\n    var name = self.name;\n    var data = {\n      name: name,\n      version: version,\n      summary: versionRecord.description,\n      description: versionRecord.longDescription,\n      publishedBy:\n      versionRecord.publishedBy && versionRecord.publishedBy.username,\n      publishedOn: new Date(versionRecord.published),\n      git: versionRecord.git,\n      exports: versionRecord.exports\n    };\n\n    // Get the export and imply data, if the record has any.\n    data[\"exports\"] = new PkgExports(versionRecord.exports);\n    data[\"implies\"] = new PkgImplies(versionRecord.dependencies);\n\n    // Processing and formatting architectures takes time, so we don't want to\n    // do this if we don't have to.\n    if (self.showArchitecturesOS) {\n      var allBuilds = catalog.official.getAllBuilds(self.name, version);\n      var architectures = _.map(allBuilds, function (build) {\n        if (! build['buildArchitectures']) {\n          return \"unknown\";\n        }\n        var archOS =\n          _.filter(build.buildArchitectures.split('+'), function (arch) {\n             return ( arch !== \"web.browser\" ) && ( arch !== \"web.cordova\" );\n        });\n        // At this point, you can only have OS arch at a time per-build.\n        return archOS[0];\n      });\n      data[\"architecturesOS\"] = architectures;\n    }\n\n    // Processing and formatting dependencies also takes time, so we would\n    // rather not do it if we don't have to.\n    if (self.showDependencies) {\n      data[\"dependencies\"] = new PkgDependencies(versionRecord.dependencies);\n    }\n\n    // We want to figure out if we have already downloaded this package, and,\n    // therefore, can use it offline.\n    var tropohouse = self.projectContext.tropohouse;\n    try {\n      data[\"installed\"] = tropohouse.installed({\n        packageName: name,\n        version: version\n      });\n    } catch (e) {\n      // Sometimes, we might be unable to determine if the package is installed\n      // -- maybe we don't have access to the directory, or there is some sort\n      // of disk corruption. This might only extend to one version, so it would\n      // be awkward to fail 'meteor show' altogether. Print an error message (if\n      // it is a permissions error, for example, that's something the user might\n      // want to know), but don't throw.\n      Console.printError(e);\n      data[\"installed\"] = false;\n    }\n    return data;\n  },\n\n  // Takes in a version record from the local catalog and looks up extra\n  // information that's relevant to this PackageQuery. Returns an object with\n  // the following keys.\n  //\n  // - name: package Name\n  // - version: package version\n  // - summary: version summary/short description (from Package.describe)\n  // - description: long-form description (from the README.md)\n  // - git: git URL for this version\n  // - local: always true (denotes that this is a local package).\n  // - directory: source directory of this package.\n  // - dependencies: (optional) if self.showDependencies is true, return an\n  //   array of objects denoting that package's dependencies. The objects have\n  //   the following keys:\n  //     - packageName: name of the dependency\n  //     - constraint: constraint for that dependency\n  //     - weak: true if this is a weak dependency.\n  _getLocalVersion: function (localRecord) {\n    var self = this;\n    var data =  {\n      name: self.name,\n      summary: localRecord.description,\n      git: localRecord.git,\n      local: true\n    };\n\n    // Get the source directory.\n    var packageSource = self.localCatalog.getPackageSource(self.name);\n    data[\"directory\"] = packageSource.sourceRoot;\n\n    // Get the exports.\n    data[\"exports\"] = new PkgExports(packageSource.getExports());\n    data[\"implies\"] = new PkgImplies(localRecord.dependencies);\n\n    // If the version was not explicitly set by the user, the catalog backfills\n    // a placeholder version for the constraint solver. We don't want to show\n    // that version to the user.\n    data[\"version\"] = packageSource.versionExplicitlyProvided ?\n      localRecord.version : \"local\";\n\n    // Processing dependencies takes time, and we don't want to do it if we\n    // don't have to.\n    if (self.showDependencies) {\n      data[\"dependencies\"] = new PkgDependencies(localRecord.dependencies);\n    }\n\n    var readmeInfo;\n    main.captureAndExit(\n      \"=> Errors while reading local packages:\",\n      \"reading \" + data[\"directory\"],\n       function () {\n        readmeInfo = packageSource.processReadme();\n    });\n    if (readmeInfo) {\n      data[\"description\"] = readmeInfo.excerpt;\n    }\n    return data;\n  },\n  // Displays version information from this PackageQuery to the terminal in a\n  // human-friendly format. Takes in an object that contains some, but not all,\n  // of the following keys:\n  //\n  // - name: (mandatory) package Name\n  // - version: (mandatory) package version\n  // - summary: version summary/short description (from Package.describe)\n  // - publishedBy: username of the publisher\n  // - publishedOn: date of publication\n  // - description: long-form description (from the README.md)\n  // - git: git URL for this version.\n  // - local: true for a local version of a package.\n  // - directory: source directory of this package.\n  // - installed: true if the package exists in warehouse, and is therefore\n  //   available for use offline.\n  // - architectures: if self.showArchitecturesOS is true, returns an\n  //   array of system architectures for which that package is available.\n  // - exports: a PkgExports object, representing package exports.\n  // - exports: a PkgImplies object, representing package implies.\n  // - dependencies: a PkgDependencies object, representing dependencies.\n  _displayVersion: function (data) {\n    var self = this;\n    Console.info(\n        data.name + \"@\" + data.version,\n        Console.options({ bulletPoint: \"Package: \" }));\n    if (data.directory) {\n      Console.info(\"Directory: \" + Console.path(data.directory));\n    }\n    if (data.exports && ! data.exports.isEmpty()) {\n      Console.info(\n        data[\"exports\"].getConsoleStr(),\n        Console.options({ bulletPoint: \"Exports: \" }));\n    }\n    if (data.implies && ! data.implies.isEmpty()) {\n      Console.info(\n        data[\"implies\"].getConsoleStr(),\n        Console.options({ bulletPoint: \"Implies: \" }));\n    }\n    if (data.git) {\n      Console.info(\n        Console.url(data.git),\n        Console.options({ bulletPoint: \"Git: \" }));\n    }\n\n    // If we don't have a long-form description, print the summary. (If we don't\n    // have a summary, print nothing).\n    if (data.description || data.summary) {\n      Console.info();\n      Console.info(data.description || data.summary);\n    }\n\n    // Print dependency information, if the package has any dependencies.\n    if (data.dependencies && ! data.dependencies.isEmpty()) {\n      Console.info();\n      Console.info(\"Depends on:\");\n      Console.info(\n          data.dependencies.getConsoleStr(),\n          Console.options({ indent: 2 }));\n    }\n\n    // Print the 'published by' line at the very bottom.\n    if (data.publishedBy) {\n      var publisher = data.publishedBy;\n      var pubDate = utils.longformDate(data.publishedOn);\n      Console.info();\n      Console.info(\"Published by\", publisher, \"on\", pubDate + \".\");\n    }\n\n    // Sometimes, there is a server package and a local package with the same\n    // version. In this case, we prefer the local package. Explain our choice to\n    // the user.\n    if (data.local &&\n        catalog.official.getVersion(data.name, data.version)) {\n      Console.info();\n      Console.info(\n        \"This package version is built locally from source.\",\n        \"The same version of this package also exists on the package server.\",\n        \"To view its metadata, run\",\n        Console.command(\"'meteor show \" + data.name + \"@\" + data.version + \"'\"),\n        \"from outside the project.\");\n    }\n  },\n  // Returns a user-friendly object from this PackageQuery to the caller.  Takes\n  // in a data object with the same keys as _displayVersion.\n  //\n  // Returns an object with some of the following keys:\n  // - name: String. Name of the package.\n  // - version: String. Meteor version number.\n  // - description: String. Longform description.\n  // - summary: String. Short summary.\n  // - git: String. Git URL.\n  // - publishedBy: String. Username of the publisher.\n  // - publishedOn: Date. Time of publication.\n  // - local: Boolean. True if this is a local package.\n  // - directory: source directory of this package.\n  // - installed: Boolean. True if the isopack for this package has been\n  //   downloaded, or if the package is local.\n  // - dependencies: Array of objects representing package dependencies, sorted\n  //   alphabetically by package name.\n  // - OSarchitectures: Array of OS architectures on for which an isopack of\n  //   this package exists (server packages only).\n  // - exports: Array of objects representing the package exports, sorted by\n  //   name of export.\n  _generateVersionObject: function (data) {\n    var versionFields = [\n      \"name\", \"version\", \"description\", \"summary\", \"git\", \"directory\",\n      \"publishedBy\", \"publishedOn\", \"installed\", \"local\", \"architecturesOS\",\n    ];\n    var processedData = {};\n    _.each([\"exports\", \"implies\", \"dependencies\"], function (key) {\n      processedData[key] = data[key] ? data[key].getObject() : [];\n    });\n    return _.extend(processedData, _.pick(data, versionFields));\n  },\n\n  // Displays general package data from this PackageQuery to the terminal in a\n  // human-friendly format. Takes in an object that contains some, but not\n  // always all, of the following keys:\n  //\n  // - name: (mandatory) package name\n  // - maintainers: array of usernames of maintainers\n  // - homepage: string of the package homepage\n  // - defaultVersion: the default version of this package to use for looking up\n  //   per-version information that's relevant to the package in general (ex:\n  //   git).\n  // - totalVersions: the total number of versions that this package has,\n  //   including hidden versions.\n  // - versions: an ordered array of objects, representing the versions of this\n  //   package that we should return to the user. Each version should contain\n  //   some of the following keys:\n  //     - version: (mandatory) version number, or \"local\" for a version-less\n  //       local package.\n  //     - publishedOn: the date that the package was published.\n  //     - installed: true if this is a server package that has already been\n  //       downloaded to the warehouse.\n  //     - local: true for a local package.\n  //     - directory: source root directory of a local package.\n  // - hiddenVersions: an object containing some information about versions that\n  //   have been hidden from the user. Has keys:\n  //     - oldestVersion: the version of this package with the smallest Meteor\n  //       semver number that exists in our records.\n  //     - lastUnmigrated: the most recent (largest Meteor semver) version that\n  //       is marked 'unmigrated'.\n  //     - lastPreRelease: the most recent pre-release version.\n  _displayPackage: function (data) {\n    var self = this;\n    var defaultVersion = data.defaultVersion;\n\n    // Every package has a name. Some packages have a homepage.\n    var displayName = data.defaultVersion ?\n      data.name + \"@\" + data.defaultVersion.version : data.name;\n    Console.info(displayName, Console.options({ bulletPoint: \"Package: \" }));\n    if (data.homepage) {\n      Console.info(Console.url(data.homepage),\n        Console.options({ bulletPoint: \"Homepage: \" }));\n    }\n    // Local packages might not have any maintainers.\n    if (! _.isEmpty(data.maintainers)) {\n      Console.info(data.maintainers.join(\", \"),\n        Console.options({ bulletPoint: \"Maintainers: \" }));\n    }\n    // Git is per-version, so we will print the latest one, if one exists.\n    if (defaultVersion && defaultVersion.git) {\n      Console.info(Console.url(defaultVersion.git),\n        Console.options({ bulletPoint: \"Git: \" }));\n    }\n    // Print the exports.\n    if (defaultVersion && defaultVersion.exports &&\n       ! defaultVersion.exports.isEmpty()) {\n      Console.info(\n        defaultVersion[\"exports\"].getConsoleStr(),\n        Console.options({ bulletPoint: \"Exports: \" }));\n    }\n    if (defaultVersion && defaultVersion.implies &&\n        ! defaultVersion.implies.isEmpty()) {\n      Console.info(\n        defaultVersion[\"implies\"].getConsoleStr(),\n        Console.options({ bulletPoint: \"Implies: \" }));\n    }\n    Console.info();\n\n    // If we don't have a long-form description, we will use the summary. For a\n    // local package, we might not have a summary, in which case we should be\n    // careful not to print extra lines.\n    var printDescription = defaultVersion &&\n      (defaultVersion.description || defaultVersion.summary);\n    if (printDescription) {\n      Console.info(printDescription );\n      Console.info();\n    }\n\n    // If we have any versions to show, print them out now.\n    var versionRows = [];\n    if (data.versions && ! _.isEmpty(data.versions)) {\n      var versionsHeader =\n            self.showHiddenVersions ? \"Versions:\" : \"Recent versions:\";\n      Console.info(versionsHeader);\n      _.each(data.versions, function (v) {\n\n        // For a local package, we don't have a published date, and we don't\n        // need to show if it has already been downloaded (it is local, we don't\n        // need to download it). Instead of showing both of these values, let's\n        // show the directory.\n        if (v.local) {\n          versionRows.push([v.version, v.directory]);\n          return;\n        }\n\n        // Convert the date into a display-friendly format, or print nothing for\n        // a local package.\n        var publishDate = utils.longformDate(v.publishedOn);\n\n        // If there is a status that we would like to report for this package,\n        // figure it out now.\n        if (v.installed) {\n          var paddedDate = padLongformDate(publishDate);\n          versionRows.push([v.version, paddedDate + \"  \" + \"installed\"]);\n        } else {\n          versionRows.push([v.version, publishDate]);\n        }\n      });\n      // The only time that we are going to go over a reasonable character limit\n      // is with a directory for the local package. We would much rather display\n      // the full directory than trail it off.\n      Console.printTwoColumns(versionRows, { indent: 2, ignoreWidth: true });\n    }\n\n    // If we have not shown all the available versions, let the user know.\n    if (data.totalVersions > versionRows.length) {\n      var oldestShownVersion =\n        (data[\"versions\"][0] && data[\"versions\"][0].version) || \"\";\n      // A string explaining why those versions have been hidden.\n      var hiddenVersions =\n         formatHiddenVersions(data[\"hiddenVersions\"], oldestShownVersion);\n\n      // We will word things in the message in different ways, based on whether\n      // multiple versions exist/have been hidden.\n      var hiddenVersionsPluralizer =\n         (data.totalVersions - data.versions.length == 1) ?\n         \"One \" + hiddenVersions + \" version of \" + self.name + \" has\" :\n         hiddenVersions[0].toUpperCase() + hiddenVersions.slice(1) +\n         \" versions of \" + self.name + \" have\";\n      var allVersionsPluralizer =\n         (data.totalVersions === 1) ?\n         \"the hidden version\" :\n         \"all \" + data.totalVersions + \" versions\";\n\n      // Display the final message.\n      Console.info(\n        hiddenVersionsPluralizer, \"been hidden.\",\n        \"To see \" + allVersionsPluralizer + \", run\",\n        Console.command(\"'meteor show --show-all \" + self.name + \"'\") + \".\");\n    }\n  },\n  // Returns a user-friendly object from this PackageQuery to the caller.  Takes\n  // in a data object with the same keys as _displayPackage.\n  //\n  // Returns an object with some of the following keys:\n  // - name: String. Name of the package.\n  // - homepage: String. URL of the package homepage.\n  // - maintainers: Array of strings. Usernames of package maintainers.\n  // - totalVersions: Number. Total number of versions that exist for this\n  //   package.\n  // - versions: Array of objects, representing versions of this\n  //   package. Objects have the following keys:\n  //   - name: String. Name of the package.\n  //   - version: String. Meteor version number.\n  //   - description: String. Longform description.\n  //   - summary: String. Short summary.\n  //   - git: String. Git URL.\n  //   - publishedBy: String. Username of the publisher.\n  //   - publishedOn: Date. Time of publication.\n  //   - local: Boolean. True if this is a local package.\n  //   - directory: source directory of this package.\n  //   - installed: Boolean. True if the isopack for this package has been\n  //     downloaded, or if the package is local.\n  //   - exports: Array of objects representing the package exports, sorted by\n  //     name of export.\n  _generatePackageObject: function (data) {\n    var packageFields =\n          [ \"name\", \"homepage\", \"maintainers\", \"totalVersions\" ];\n    // Process the versions array. We only want some of the keys, and we want to\n    // make sure to get the right exports object.\n    var versions = _.map(data[\"versions\"], function (version) {\n      var versionFields = [\n        \"name\", \"version\", \"description\", \"summary\", \"git\", \"publishedBy\",\n        \"publishedOn\", \"installed\", \"local\", \"directory\", \"architecturesOS\"\n      ];\n      var processedData = {};\n      _.each([\"exports\", \"implies\"], function (key) {\n        processedData[key] = version[key] ? version[key].getObject() : [];\n      });\n      return _.extend(processedData, _.pick(version, versionFields));\n    });\n    return _.extend({ versions: versions }, _.pick(data, packageFields));\n  },\n\n});\n\n// This class looks up release-related information in the official catalog.\n//\n// The constructor takes in an object with the following keys:\n//   - metaRecord: (mandatory) the meta-record for this release from the\n//     Releases collection.\n//   - version: specific version of a release that we want to query.\n//   - showHiddenVersions: show experimental, pre-release & otherwise\n//     non-recommended versions of this release.\nvar ReleaseQuery = function (options) {\n  var self = this;\n\n  // This is the record in the Releases collection. Contains metadata, such as\n  // maintainers.\n  self.metaRecord = options.metaRecord;\n  self.name = options.metaRecord.name;\n\n  // We don't always want to show non-recommended release versions.\n  self.showHiddenVersions = options.showHiddenVersions;\n\n  // Aggregate the query data. If we are asking for a specific version, get data\n  // for a specific version, otherwise aggregate the data about this release\n  // track in general.\n  self.data = options.version ?\n    self._getVersionDetails(options.version) :\n    self._getReleaseData();\n};\n\n_.extend(ReleaseQuery.prototype, {\n  // Prints the data from this ReleaseQuery to the terminal. Takes the following\n  // options:\n  //   - ejson: Don't pretty-print the data. Return a machine-readable ejson\n  //     object.\n  print: function (options) {\n    var self = this;\n\n    // If we are asking for an EJSON-style output, print out the relevant fields.\n    if (options.ejson) {\n      var versionFields = [\n        \"track\", \"version\", \"description\", \"publishedBy\", \"publishedOn\",\n        \"tool\", \"packages\", \"recommended\"\n      ];\n      var packageFields = [ \"name\", \"maintainers\", \"versions\" ];\n      var fields = self.data.version ? versionFields : packageFields;\n      Console.rawInfo(formatEJSON(_.pick(self.data, fields)));\n      return;\n    }\n\n    // If we are asking for a specific version, display the information about\n    // that version.\n    if (self.data.version) {\n      self._displayVersion(self.data);\n      return;\n    }\n    // Otherwise, print the data about this release track in general.\n    self._displayRelease(self.data);\n  },\n\n  // Gets detailed data about a specific version of this release. Returns an\n  // object with the following keys:\n  //  - track: name of the release track\n  //  - version: release version\n  //  - description: description of the release version\n  //  - recommended: if this is a recommended version.\n  //  - orderKey: the orderKey of this version\n  //  - publishedBy: username of the publisher\n  //  - publishedOn: date this version was published\n  //  - packages: map of packages that go into this version\n  //  - tool: the tool package@version for this release version\n  _getVersionDetails: function (version) {\n    var self = this;\n    var versionRecord =\n       catalog.official.getReleaseVersion(self.name, version);\n    if (! versionRecord) {\n      return null;\n    }\n    var publishDate = getReleaseVersionPublishedOn(versionRecord);\n    return {\n      track: self.name,\n      version: version,\n      description: versionRecord.description,\n      recommended: versionRecord.recommended,\n      orderKey: versionRecord.orderKey,\n      publishedBy: versionRecord.publishedBy[\"username\"],\n      pubishedOn: publishDate,\n      packages: versionRecord.packages,\n      tool: versionRecord.tool\n    };\n  },\n  // Gets aggregate data about this release track in general. Returns an object\n  // with the following keys:\n  //    - track: name of the release track\n  //    - maintainers: an array of usernames of maintainers\n  //    - defaultVersion: version record for the default version of this release.\n  //    - totalVersions: total number of release versions for this track\n  //    - versions: an array of version objects. If only recommended versions\n  //      are returned, ordered by orderKey, otherwise unordered. Objects have\n  //      the following keys:\n  //         - version: version number\n  //         - description: version description\n  //         - recommended: true for recommended versions\n  //         - orderKey: (only if showHiddenVersions is true) the orderKey of\n  //           this version.\n  //         - publishedBy: username of the publisher\n  //         - publishedOn: date the version was published\n  _getReleaseData: function () {\n    var self = this;\n    var data = {\n      track: self.metaRecord.name,\n      maintainers: _.pluck(self.metaRecord.maintainers, \"username\")\n    };\n    data[\"defaultVersion\"] =\n      catalog.official.getDefaultReleaseVersionRecord(self.name);\n\n    // Collect information about versions.\n    var versions;\n    if (self.showHiddenVersions) {\n      // There is no obvious way to get an absolute ranking of all release\n      // versions, so this is unsorted. If we have to, we will deal with sorting\n      // this at display time.\n      versions = catalog.official.getReleaseVersionRecords(self.name);\n    } else {\n      versions = catalog.official.getSortedRecommendedReleaseRecords(self.name);\n      versions.reverse();\n    }\n\n    // We don't want to show the user package or tool data in general release\n    // mode (it is a lot of data). Select to show the fields that we want to\n    // return only.\n    var versionFields =\n       [ \"version\", \"description\", \"recommended\"];\n\n    // orderKey is important for dealing with experimental versions, but it is\n    // an internal system detail that we would rather not reveal at this level.\n    if (self.showHiddenVersions) {\n      versionFields.push(\"orderKey\");\n    }\n    data[\"versions\"] = _.map(versions, function (versionRecord) {\n      var data = _.pick(versionRecord, versionFields);\n      data.publishedBy = versionRecord.publishedBy[\"username\"];\n      data.publishedOn = getReleaseVersionPublishedOn(versionRecord);\n      return data;\n    });\n    data[\"totalVersions\"] = catalog.official.getNumReleaseVersions(self.name);\n    return data;\n  },\n  // Displays information about a specific release version in a human-readable\n  // format. Takes in an object with the following keys:\n  // - track: release track\n  // - version: release version\n  // - publishedBy: username of the publisher\n  // - publishedOn: date the version was published\n  // - recommended: true if this is a recommended version\n  // - description: description of the release version\n  // - tool: tool package specification for this version\n  // - packages: map of packages for this release version\n  _displayVersion: function (data) {\n    var self = this;\n    Console.info(\"Release: \" + data.track + \"@\" + data.version);\n    var isRecommended = data.recommended ? \"yes\" : \"no\";\n    Console.info(\"Recommended: \" + isRecommended);\n    Console.info(\"Tool package: \" + data.tool);\n    Console.info();\n    Console.info(data.description);\n    Console.info();\n    if (!_.isEmpty(data.packages)) {\n      Console.info(\"Packages:\");\n      _.each(data.packages, function (version, packageName) {\n          Console.info(\n            packageName + \": \" + version,\n            Console.options({ indent: 2 }));\n      });\n      Console.info();\n    }\n    Console.info(\n      \"Published by \" + data.publishedBy + \" on \" +\n      utils.longformDate(getReleaseVersionPublishedOn(data)));\n  },\n  // Displays information about this release track in general in a\n  // human-readable format. Takes in an object with the following keys:\n  //    - track: name of the release track\n  //    - maintainers: an array of usernames of maintainers\n  //    - defaultVersion: version record for the default version of this release.\n  //    - totalVersions: total number of release versions for this track\n  //    - versions: an array of version objects. If only recommended versions\n  //      are returned, ordered by orderKey, otherwise unordered. Objects have\n  //      the following keys:\n  //         - version: version number\n  //         - description: version description\n  //         - recommended: true for recommended versions\n  //         - orderKey: (only if showHiddenVersions is true) the orderKey of\n  //           this version.\n  //         - publishedBy: username of the publisher\n  //         - publishedOn: date the version was published\n  _displayRelease: function (data) {\n    var self = this;\n\n    Console.info(\"Release:\",  data.track);\n    // There is no such thing as a local release, which means all releases have\n    // a maintainer.\n    Console.info(\"Maintainers:\", data.maintainers.join(\", \"));\n    Console.info();\n\n    if (data.defaultVersion) {\n      Console.info(data.defaultVersion.description);\n      Console.info();\n    }\n\n    if (self.showHiddenVersions) {\n      self._displayAllReleaseVersions(data.versions);\n      return;\n    }\n\n    // Display the recommended versions of this release.\n    var rows = [];\n    if (!_.isEmpty(data.versions)) {\n      Console.info(\"Recommended versions:\");\n      _.each(data.versions, function (v) {\n        rows.push([v.version, utils.longformDate(v.publishedOn)]);\n      });\n      Console.printTwoColumns(rows, { indent: 2 });\n    };\n\n    // Display a warning about other release versions at the bottom.\n    if (data.totalVersions > rows.length) {\n      var versionsPluralizer =\n            (data.totalVersions > 1) ?\n            \"all \" + data.totalVersions + \" versions\" :\n            \"the hidden version\";\n      // We only hide release versions for one reason -- they are not\n      // recommended. We would have to parse version numbers to differentiate\n      // between 'pre-release' and 'deprecated' (and sort-of-experimental, like\n      // '1.0-weird-trick) and we don't want to rely on version number\n      // conventions in code.\n      var versionsHidden =\n            (data.totalVersions - rows.length > 1) ?\n            \"Non-recommended versions of \" + self.name + \" have been hidden.\" :\n            \"One non-recommended version of \" + self.name + \" has been hidden.\";\n\n      Console.info(\n        versionsHidden,\n        \"To see \" + versionsPluralizer + \", run\",\n        Console.command(\"'meteor show --show-all \" + self.name + \"'\") + \".\");\n    }\n  },\n  // Displays all the versions of a given release in a human-readable\n  // format. Includes experimental and otherwise hidden versions. Takes in an\n  // array of version objects, each of which has the following keys:\n  //  - version: version string\n  //  - orderKey: (optional) orderKey of this version. Not all versions have\n  //    orderKeys.\n  //  - publishedOn: date of publication\n  //  - recommended: true if the version is recommended.\n  _displayAllReleaseVersions: function (versions) {\n    var self = this;\n    var columnOpts = { indent: 2, ignoreWidth: true };\n    // If we don't have any versions, then there is nothing to display.\n    if (! versions) { return; }\n\n    // We are going to print versions with order key ('versions'), separately\n    // from versions without an order key ('experimental versions').\n    var versionsDivided = _.groupBy(versions, function (v) {\n      return _.has(v, \"orderKey\");\n    });\n    var experimentalVersions = versionsDivided[false];\n    var versionsWithKey = versionsDivided[true];\n\n    if (versionsWithKey) {\n      // Sort versions that have order keys by order key, so that 1.0 comes\n      // after 0.9.4.1, etc.\n      versionsWithKey = _.sortBy(versionsWithKey, function (v) {\n        return v.orderKey;\n      });\n      Console.info(\"Versions:\");\n      var rows = [];\n      _.each(versionsWithKey, function (vr) {\n        var dateStr = utils.longformDate(vr.publishedOn);\n        if (! vr.recommended) {\n          rows.push([ vr.version, dateStr ]);\n        } else {\n          var paddedDate = padLongformDate(dateStr);\n          rows.push([ vr.version, paddedDate + \"  (recommended)\" ]);\n        }\n      });\n      Console.printTwoColumns(rows, columnOpts);\n    }\n\n    if (experimentalVersions) {\n      // We can't sort by order key, so sort by order of publication.\n      experimentalVersions = _.sortBy(experimentalVersions, function (v) {\n        return v.publishedOn;\n      });\n      Console.info(\"Experimental versions:\");\n      var rows = [];\n      _.each(experimentalVersions, function (vr) {\n        // Experimental versions cannot be recommended.\n        rows.push([vr.version, utils.longformDate(vr.publishedOn)]);\n      });\n      Console.printTwoColumns(rows, columnOpts);\n    }\n  }\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// show\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'show',\n  pretty: true,\n  minArgs: 0,\n  maxArgs: 1,\n  usesPackage: true,\n  options: {\n    \"show-all\": { type: Boolean },\n    \"ejson\": { type: Boolean }\n  },\n  catalogRefresh:\n    new catalog.Refresh.OnceAtStart(\n        { maxAge: DEFAULT_MAX_AGE_MS, ignoreErrors: true })\n}, function (options) {\n  var fullName;\n  var name;\n  var version;\n  // Because of the new projectContext interface, we need to initialize the\n  // project context in order to load the local catalog. This is not ideal.\n  var projectContext = getTempContext(options);\n\n  // If the user specified a query, process it.\n  if (! _.isEmpty(options.args)) {\n    // The foo@bar API means that we have to do some string parsing to figure out\n    // if we want a particular version.\n    fullName = options.args[0];\n    var splitArgs = fullName.split('@');\n    name = splitArgs[0];\n    version = (splitArgs.length > 1) ? splitArgs[1] : null;\n    if (splitArgs.length > 2) {\n      Console.error(\"Invalid request format: \" + fullName);\n      process.exit(1);\n    }\n  } else {\n    if (! options.packageDir) {\n      // Letting the user run 'meteor show' without arguments from a package\n      // directory is a pleasant shortcut, but the default should be specifying\n      // a query.\n      Console.error(\n        \"Please specify a package or release name to show information about it.\"\n      );\n      process.exit(1);\n    }\n    // Use the projectContext to get the name of the package.\n    var currentVersion =\n          projectContext.localCatalog.getVersionBySourceRoot(options.packageDir);\n    name = currentVersion.packageName;\n    version = \"local\";\n    fullName = name + \"@local\";\n  }\n  var query = null;\n\n  // First, we need to figure out if we are dealing with a package, or a\n  // release. We don't want to rely on capitalization conventions, so we will\n  // start by checking if a package by that name exists. If it does, then we are\n  // dealing with a package. (Unlike the normal projectContext, we want to\n  // prefer the remote record, if one exists, rather than the local record. The\n  // remote record contains data like 'homepage' and 'maintainers', that the\n  // local record does not).\n  var packageRecord =\n        catalog.official.getPackage(name) ||\n        projectContext.localCatalog.getPackage(name);\n  if (packageRecord) {\n    query =  new PackageQuery({\n      metaRecord: packageRecord,\n      version: version,\n      projectContext: projectContext,\n      showHiddenVersions: options[\"show-all\"],\n      showArchitecturesOS: options.ejson,\n      showDependencies: !! version\n    });\n  }\n\n  // If this is not a package, it might be a release. Let's check if there is\n  // a release by this name. There are no local releases, so we only need to\n  // check the official catalog.\n  if (! query) {\n    var releaseRecord = catalog.official.getReleaseTrack(name);\n    if (releaseRecord) {\n      query = new ReleaseQuery({\n        metaRecord: releaseRecord,\n        version: version,\n        showHiddenVersions: options[\"show-all\"]\n      });\n    }\n  }\n  // If we have failed to create a query, or if we have created a query and it\n  // couldn't gather any data about our request, then the item that we are\n  // looking for does not exist.\n  if (! query || ! query.data) {\n    return itemNotFound(fullName);\n  }\n\n  query.print({ ejson: !! options.ejson });\n  return 0;\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// search\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'search',\n  pretty: true,\n  usesPackage: true,\n  minArgs: 0, // So we can provide specific help\n  maxArgs: 1,\n  options: {\n    maintainer: { type: String },\n    \"show-all\": { type: Boolean },\n    ejson: { type: Boolean },\n    // Undocumented debug-only option (originally added for Velocity).\n    \"debug-only\": { type: Boolean },\n    \"prod-only\": { type: Boolean },\n    \"test-only\": { type: Boolean },\n  },\n  catalogRefresh:\n    new catalog.Refresh.OnceAtStart(\n      { maxAge: DEFAULT_MAX_AGE_MS, ignoreErrors: true })\n}, function (options) {\n  if (options.args.length === 0) {\n    Console.info(\n      \"To show all packages, do\", Console.command(\"meteor search .\"));\n    return 1;\n  }\n\n  // Because of the new projectContext interface, we need to initialize the\n  // project context in order to load the local catalog.\n  var projectContext = getTempContext(options);\n\n  // XXX We should push the queries into SQLite!\n  var allPackages = _.union(\n    catalog.official.getAllPackageNames(),\n    projectContext.localCatalog.getAllPackageNames());\n  var allReleases = catalog.official.getAllReleaseTracks();\n  var matchingPackages = [];\n  var matchingReleases = [];\n\n  var selector;\n  var pattern = options.args[0];\n\n  var search;\n  try {\n    search = new RegExp(pattern);\n  } catch (err) {\n    Console.error(err + \"\");\n    return 1;\n  }\n\n  // Do not return true on broken packages, unless requested in options.\n  var filterBroken = function (match, isRelease, name) {\n    // If the package does not match, or it is not a package at all or if we\n    // don't want to filter anyway, we do not care.\n    if (!match || isRelease) {\n      return match;\n    }\n    var vr;\n    if (!options[\"show-all\"]) {\n      // If we can't find a version in the local catalog, we want to get the\n      // latest mainline (ie: non-RC) version from the official catalog.\n      vr = projectContext.localCatalog.getLatestVersion(name) ||\n        catalog.official.getLatestMainlineVersion(name);\n    } else {\n      // We want the latest version of this package, and we don't care if it is\n      // a release candidate.\n      vr = projectContext.projectCatalog.getLatestVersion(name);\n    }\n    if (!vr) {\n      return false;\n    }\n    // If we did NOT ask for unmigrated packages and this package is unmigrated,\n    // we don't care.\n    if (!options[\"show-all\"] && vr.unmigrated){\n      return false;\n    }\n    // If we asked for debug-only packages and this package is NOT debug only,\n    // we don't care.\n    if (options[\"debug-only\"] && !vr.debugOnly) {\n      return false;\n    }\n    // If we asked for prod-only packages and this package is NOT prod only,\n    // we don't care.\n    if (options[\"prod-only\"] && !vr.prodOnly) {\n      return false;\n    }\n    // If we asked for test-only packages and this package is NOT test only,\n    // we don't care.\n    if (options[\"test-only\"] && !vr.testOnly) {\n      return false;\n    }\n    return true;\n  };\n\n  if (options.maintainer) {\n    var username =  options.maintainer;\n    // In the future, we should consider checking this on the server, but I\n    // suspect the main use of this command will be to deal with the automatic\n    // migration and uncommon in everyday use. From that perspective, it makes\n    // little sense to require you to be online to find out what packages you\n    // own; and the consequence of not mentioning your group packages until\n    // you update to a new version of meteor is not that dire.\n    selector = function (name, isRelease) {\n      var record;\n      // XXX make sure search works while offline\n      if (isRelease) {\n        record = catalog.official.getReleaseTrack(name);\n      } else {\n        record = catalog.official.getPackage(name);\n      }\n      return filterBroken(\n        (name.match(search) &&\n         record && !!_.findWhere(record.maintainers, {username: username})),\n        isRelease, name);\n    };\n  } else {\n    selector = function (name, isRelease) {\n      return filterBroken(name.match(search),\n        isRelease, name);\n    };\n  }\n\n  buildmessage.enterJob({ title: 'Searching packages' }, function () {\n    _.each(allPackages, function (pack) {\n      if (selector(pack, false)) {\n        var vr;\n        if (!options['show-all']) {\n          vr =\n            projectContext.localCatalog.getLatestVersion(pack) ||\n            catalog.official.getLatestMainlineVersion(pack);\n        } else {\n          vr = projectContext.projectCatalog.getLatestVersion(pack);\n        }\n        if (vr) {\n          matchingPackages.push({\n            name: pack,\n            description: vr.description,\n            latestVersion: vr.version,\n            lastUpdated: new Date(vr.lastUpdated)\n          });\n        }\n      }\n    });\n    _.each(allReleases, function (track) {\n      if (selector(track, true)) {\n        var vr = catalog.official.getDefaultReleaseVersionRecord(track);\n        if (vr) {\n          matchingReleases.push({\n            name: track,\n            description: vr.description,\n            latestVersion: vr.version,\n            lastUpdated: new Date(vr.lastUpdated)\n          });\n        }\n      }\n    });\n  });\n\n  if (options.ejson) {\n    var ret = {\n      packages: matchingPackages,\n      releases: matchingReleases\n    };\n    Console.rawInfo(formatEJSON(ret));\n    return 0;\n  }\n\n  var output = false;\n  if (!_.isEqual(matchingPackages, [])) {\n    output = true;\n    Console.info(\"Matching packages:\");\n    utils.printPackageList(matchingPackages);\n  }\n\n  if (!_.isEqual(matchingReleases, [])) {\n    output = true;\n    Console.info(\"Matching releases:\");\n    utils.printPackageList(matchingReleases);\n  }\n\n  if (!output) {\n    Console.error(pattern + ': nothing found');\n    catalogUtils.explainIfRefreshFailed();\n  } else {\n    Console.info(\n      \"You can use\", Console.command(\"'meteor show'\"),\n      \"to get more information on a specific item.\");\n  }\n});\n"],"file":"tools/cli/commands-packages-query.js.map"}