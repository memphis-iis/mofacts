{"version":3,"sources":["/tools/cli/commands.js"],"names":["_objectSpread","module","link","default","v","export","parseServerOptionsForRunCommand","parseRunTargets","ensureDevBundleDependencies","CordovaRunner","iOSRunTarget","AndroidRunTarget","EXAMPLE_REPOSITORIES","main","require","_","files","deploy","buildmessage","auth","authClient","config","runLog","utils","httpHelpers","archinfo","catalog","stats","Console","projectContextModule","release","Profile","DEPLOY_ARCH","DEFAULT_PORT","__dirnameConverted","convertToStandardPath","__dirname","qualifySitename","site","indexOf","length","substring","showInvalidArchMsg","arch","info","each","keys","VALID_ARCHITECTURES","va","command","options","indent","runTargets","parsedServerUrl","parsePortOption","port","mobileServerOption","parsedMobileServerUrl","parseMobileServerOption","isRunOnDeviceRequested","any","runTarget","isDevice","detectMobileServerUrl","parsedCordovaServerPort","parseCordovaServerPortOption","portOption","parseUrl","error","ExitWithCode","optionName","protocol","hostname","cordovaServerPortOption","parseInt","myIp","ipAddress","message","targets","map","target","targetParts","split","platform","excludableWebArchs","filterWebArchs","webArchs","excludeArchsOption","excludeArchs","trim","filter","includes","registerCommand","name","requiresRelease","pretty","catalogRefresh","Refresh","Never","rawInfo","host","current","appDir","Error","isCheckout","gitLog","runGitInCheckout","getDisplayName","inCheckout","getToolsVersion","inspectOptions","type","String","implicitValue","normalizeInspectOptions","result","Object","create","has","console","log","inspect","runCommandOptions","requiresApp","maxArgs","Infinity","short","Boolean","production","settings","verbose","once","extend","doRunCommand","setVerbose","args","includePackages","projectContext","ProjectContext","projectDir","allowIncompatibleUpdate","lintAppAndLocalPackages","captureAndExit","readProjectMetadata","explicit","releaseFile","fullReleaseName","displayReleaseName","appHost","appPort","appPortMatch","match","warn","setRawLogs","platformList","getWebArchs","isEmpty","push","cordovaRunner","prepareCordovaProject","CordovaProject","cordovaProject","settingsFile","mobileServerUrl","formatUrl","cordovaServerPort","jobHasMessages","checkPlatformsForRunTargets","runAll","run","proxyPort","proxyHost","buildOptions","minifyMode","buildMode","rootUrl","process","env","ROOT_URL","mongoUrl","MONGO_URL","oplogUrl","MONGO_OPLOG_URL","noReleaseCheck","METEOR_NO_RELEASE_CHECK","connect","convertToOSPath","getMeteorShellDirectory","WaitForExit","list","example","package","bare","minimal","full","react","vue","typescript","apollo","packageName","ShowUsage","validatePackageNameOrExit","detailedColonExplanation","fsName","packageDir","pathResolve","inYourApp","exists","transform","x","xn","replace","relString","rel","official","getDefaultReleaseVersion","version","noPrefix","cp_r","pathJoin","transformFilename","f","transformContents","contents","test","Buffer","from","toString","ignore","preserveSymlinks","err","displayPackageDir","pathRelative","cwd","path","forced","latestKnown","SpringboardToLatestRelease","repoInfo","branchInfo","branch","repo","branchOption","appPathAsEntered","appPath","findAppDir","appName","pathBasename","nonCodeFileExts","destinationHasCodeFiles","readdir","thisPathCountsAsAFile","filePath","isHidden","stat","isDirectory","ext","pathExtname","contains","toIgnore","skelName","alwaysWritePackageMap","write","projectConstraintsFile","updateReleaseConstraints","_manifest","upgraders","finishedUpgraders","appendUpgraders","allUpgraders","prepareProjectForBuild","install","includeDevDependencies","appNameToDisplay","cmd","text","appPathWithQuotesIfSpaces","url","join","buildCommands","minArgs","debug","directory","architecture","server","headless","Promise","await","buildCommand","hidden","_bundleOnly","setHeadless","bundleArch","serverArchitectures","uniq","packageMapDelta","displayOnConsole","serverOnly","cordovaPlatforms","getCordovaPlatforms","without","buildDir","getProjectLocalDirectory","outputPath","relative","substr","labelWarn","bundlePath","recordPackages","what","bundler","bundleResult","bundle","serverArch","errors","formatMessages","mkdir_p","outputTar","createTarball","exception","rm_recursive","pluginVersionsFromStarManifest","displayNameForPlatform","enterJob","title","pluginVersions","starManifest","prepareFromAppBundle","buildPath","platformOutputPath","prepareForPlatform","buildForPlatform","writeFile","apkPath","copyFile","requiresAppOrPackage","tempProjectDir","mkdtemp","explicitlyAddedLocalPackageDirs","packageMapFilename","forceIncludeCordovaUnibuild","lintPackageWithSourceRoot","initializeCatalog","versionRecord","localCatalog","getVersionBySourceRoot","constraint","parsePackageConstraint","removeAllPackages","addConstraints","displayName","warnings","usedMeteorAccount","findMongoPort","mongoPort","temporaryMongoUrl","maybePrintRegistrationLink","stdin","pause","runMongo","runMongoShell","isRunning","rm_recursive_async","then","password","Number","allowUnrecognizedOptions","delete","deployCommand","rawOptions","deleteApp","loggedIn","isLoggedIn","registerOrLogIn","buildArch","deployPollingTimeoutMs","isCacheBuildEnabled","waitForDeploy","deployResult","bundleAndDeploy","leadingNewline","firstTime","add","transfer","remove","pick","pollForRegistrationCompletion","changeAuthorized","listAuthorized","testCommandOptions","ios","android","doTestCommand","global","testCommandMetadata","intersection","testRunnerAppDir","testAppPath","absTestAppPath","driverPackage","projectContextOptions","projectDirForLocalPackages","code","packagesByPath","p","packagesToAdd","getTestPackageNames","excludedPackages","exclude","some","excluded","unshift","constraintsToAdd","writeIfModified","isAppTest","isTest","projectLocalDir","copyDirIntoTestRunnerApp","allowSymlink","parts","appDirPath","testDirPath","pathDirname","symlink","platformsForRunTargets","runTestAppForPackages","packageNames","packageNamesSpecifiedExplicitly","getAllPackageNames","testPackages","getLatestVersion","testName","recordPackageUsage","disableOplog","testMetadata","banner","selenium","seleniumBrowser","omitPackageMapDeltaDisplayOnFirstRun","forceRebuildPackages","email","loginCommand","overwriteExistingToken","logoutCommand","whoAmICommand","loggedInAccountsConnectionOrPrompt","action","token","getSessionToken","getAccountsDomain","doUsernamePasswordLogin","retry","conn","loggedInAccountsConnection","getAccountsApiUrl","request","method","useSessionHeader","useAuthHeader","body","JSON","parse","response","statusCode","organizations","pluck","username","call","reason","members","changed","slow","galaxy","browserstack","phantom","history","file","junit","retries","selftest","offline","getUrl","e","OfflineError","compileRegexp","str","RegExp","SyntaxError","testRegexp","undefined","fileRegexp","excludeRegexp","listTests","onlyChanged","includeSlowTests","galaxyOnly","clients","puppeteer","runTests","historyLines","listSites","json","minutes","secs","spinner","progress","getCurrentProgressTracker","totalProgress","end","done","i","n","resolve","updateProgress","reportProgress","setTimeout","ething","required","key","stringify"],"mappings":"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","sourcesContent":["var main = require('./main.js');\nvar _ = require('underscore');\nvar files = require('../fs/files');\nvar deploy = require('../meteor-services/deploy.js');\nvar buildmessage = require('../utils/buildmessage.js');\nvar auth = require('../meteor-services/auth.js');\nvar authClient = require('../meteor-services/auth-client.js');\nvar config = require('../meteor-services/config.js');\nvar runLog = require('../runners/run-log.js');\nvar utils = require('../utils/utils.js');\nvar httpHelpers = require('../utils/http-helpers.js');\nvar archinfo = require('../utils/archinfo');\nvar catalog = require('../packaging/catalog/catalog.js');\nvar stats = require('../meteor-services/stats.js');\nvar Console = require('../console/console.js').Console;\nvar projectContextModule = require('../project-context.js');\nvar release = require('../packaging/release.js');\n\nconst { Profile } = require(\"../tool-env/profile\");\n\nimport { ensureDevBundleDependencies } from '../cordova/index.js';\nimport { CordovaRunner } from '../cordova/runner.js';\nimport { iOSRunTarget, AndroidRunTarget } from '../cordova/run-targets.js';\n\nimport { EXAMPLE_REPOSITORIES } from './example-repositories.js';\n\n// The architecture used by Meteor Software's hosted servers; it's the\n// architecture used by 'meteor deploy'.\nvar DEPLOY_ARCH = 'os.linux.x86_64';\n\n// The default port that the development server listens on.\nvar DEFAULT_PORT = '3000';\n\n// __dirname - the location of the current executing file\nvar __dirnameConverted = files.convertToStandardPath(__dirname);\n\n// Given a site name passed on the command line (eg, 'mysite'), return\n// a fully-qualified hostname ('mysite.meteor.com').\n//\n// This is fairly simple for now. It appends 'meteor.com' if the name\n// doesn't contain a dot, and it deletes any trailing dots (the\n// technically legal hostname 'mysite.com.' is canonicalized to\n// 'mysite.com').\n//\n// In the future, you should be able to make this default to some\n// other domain you control, rather than 'meteor.com'.\nvar qualifySitename = function (site) {\n  if (site.indexOf(\".\") === -1) {\n    site = site + \".meteor.com\";\n  }\n  while (site.length && site[site.length - 1] === \".\") {\n    site = site.substring(0, site.length - 1);\n  }\n  return site;\n};\n\n// Display a message showing valid Meteor architectures.\nvar showInvalidArchMsg = function (arch) {\n  Console.info(\"Invalid architecture: \" + arch);\n  Console.info(\"The following are valid Meteor architectures:\");\n  _.each(_.keys(archinfo.VALID_ARCHITECTURES), function (va) {\n    Console.info(\n      Console.command(va),\n      Console.options({ indent: 2 }));\n  });\n};\n\n// Utility functions to parse options in run/build/test-packages commands\n\nexport function parseServerOptionsForRunCommand(options, runTargets) {\n  const parsedServerUrl = parsePortOption(options.port);\n\n  // XXX COMPAT WITH 0.9.2.2 -- the 'mobile-port' option is deprecated\n  const mobileServerOption = options['mobile-server'] || options['mobile-port'];\n  let parsedMobileServerUrl;\n  if (mobileServerOption) {\n    parsedMobileServerUrl = parseMobileServerOption(mobileServerOption);\n  } else {\n    const isRunOnDeviceRequested = _.any(runTargets,\n      runTarget => runTarget.isDevice);\n    parsedMobileServerUrl = detectMobileServerUrl(parsedServerUrl,\n      isRunOnDeviceRequested);\n  }\n\n  const parsedCordovaServerPort = parseCordovaServerPortOption(options);\n\n  return { parsedServerUrl, parsedMobileServerUrl, parsedCordovaServerPort };\n}\n\nfunction parsePortOption(portOption) {\n  let parsedServerUrl = utils.parseUrl(portOption);\n\n  if (!parsedServerUrl.port) {\n    Console.error(\"--port must include a port.\");\n    throw new main.ExitWithCode(1);\n  }\n\n  return parsedServerUrl;\n}\n\nfunction parseMobileServerOption(mobileServerOption,\n  optionName = 'mobile-server') {\n  let parsedMobileServerUrl = utils.parseUrl(\n    mobileServerOption,\n    { protocol: 'http' });\n\n  if (!parsedMobileServerUrl.hostname) {\n    Console.error(`--${optionName} must include a hostname.`);\n    throw new main.ExitWithCode(1);\n  }\n\n  return parsedMobileServerUrl;\n}\n\nfunction parseCordovaServerPortOption(options = {}) {\n  const cordovaServerPortOption = options['cordova-server-port'];\n  return cordovaServerPortOption ? parseInt(cordovaServerPortOption, 10) : null;\n}\n\nfunction detectMobileServerUrl(parsedServerUrl, isRunOnDeviceRequested) {\n  // Always try to use an auto-detected IP first\n  try {\n    const myIp = utils.ipAddress();\n    return {\n      protocol: 'http',\n      hostname: myIp,\n      port: parsedServerUrl.port\n    };\n  } catch (error) {\n    // Unless we are being asked to run on a device, use localhost as fallback\n    if (isRunOnDeviceRequested) {\n      Console.error(\n`Error detecting IP address for mobile app to connect to:\n${error.message}\nPlease specify the address that the mobile app should connect\nto with --mobile-server.`);\n      throw new main.ExitWithCode(1);\n    } else {\n      return {\n        protocol: 'http',\n        hostname: 'localhost',\n        port: parsedServerUrl.port\n      };\n    }\n  }\n}\n\nexport function parseRunTargets(targets) {\n  return targets.map((target) => {\n    const targetParts = target.split('-');\n    const platform = targetParts[0];\n    const isDevice = targetParts[1] === 'device';\n\n    if (platform == 'ios') {\n      return new iOSRunTarget(isDevice);\n    } else if (platform == 'android') {\n      return new AndroidRunTarget(isDevice);\n    } else {\n      Console.error(`Unknown run target: ${target}`);\n      throw new main.ExitWithCode(1);\n    }\n  });\n};\n\nconst excludableWebArchs = ['web.browser', 'web.browser.legacy', 'web.cordova'];\nfunction filterWebArchs(webArchs, excludeArchsOption) {\n  if (excludeArchsOption) {\n    const excludeArchs = excludeArchsOption.trim().split(/\\s*,\\s*/)\n      .filter(arch => excludableWebArchs.includes(arch));\n    webArchs = webArchs.filter(arch => !excludeArchs.includes(arch));\n  }\n  return webArchs;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n// options that act like commands\n///////////////////////////////////////////////////////////////////////////////\n\n// Prints the Meteor architecture name of this host\nmain.registerCommand({\n  name: '--arch',\n  requiresRelease: false,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  Console.rawInfo(archinfo.host() + \"\\n\");\n});\n\n// Prints the current release in use. Note that if there is not\n// actually a specific release, we print to stderr and exit non-zero,\n// while if there is a release we print to stdout and exit zero\n// (making this useful to scripts).\n// XXX: What does this mean in our new release-free world?\nmain.registerCommand({\n  name: '--version',\n  requiresRelease: false,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  if (release.current === null) {\n    if (! options.appDir) {\n      throw new Error(\"missing release, but not in an app?\");\n    }\n    Console.error(\n      \"This project was created with a checkout of Meteor, rather than an \" +\n      \"official release, and doesn't have a release number associated with \" +\n      \"it. You can set its release with \" +\n      Console.command(\"'meteor update'\") + \".\");\n    return 1;\n  }\n\n  if (release.current.isCheckout()) {\n    var gitLog = utils.runGitInCheckout(\n      'log',\n      '--format=%h%d', '-n 1').trim();\n    Console.error(\"Unreleased, running from a checkout at \" + gitLog);\n    return 1;\n  }\n\n  Console.info(release.current.getDisplayName());\n});\n\n// Internal use only. For automated testing.\nmain.registerCommand({\n  name: '--long-version',\n  requiresRelease: false,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  if (files.inCheckout()) {\n    Console.error(\"checkout\");\n    return 1;\n  } else if (release.current === null) {\n    // .meteor/release says \"none\" but not in a checkout.\n    Console.error(\"none\");\n    return 1;\n  } else {\n    Console.rawInfo(release.current.name + \"\\n\");\n    Console.rawInfo(files.getToolsVersion() + \"\\n\");\n    return 0;\n  }\n});\n\n// Internal use only. For automated testing.\nmain.registerCommand({\n  name: '--requires-release',\n  requiresRelease: true,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  return 0;\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// run\n///////////////////////////////////////////////////////////////////////////////\n\nconst inspectOptions = {\n  \"inspect\": { type: String, implicitValue: \"9229\" },\n  \"inspect-brk\": { type: String, implicitValue: \"9229\" },\n};\n\nfunction normalizeInspectOptions(options) {\n  const result = Object.create(null);\n\n  if (_.has(options, \"debug-port\")) {\n    console.log(\n      \"The --debug-port option is deprecated; \" +\n        \"please use --inspect-brk=<port> instead.\"\n    );\n\n    if (! _.has(options, \"inspect-brk\")) {\n      options[\"inspect-brk\"] = options[\"debug-port\"];\n    }\n\n    delete options[\"debug-port\"];\n  }\n\n  if (_.has(options, \"inspect-brk\")) {\n    result.inspect = {\n      port: options[\"inspect-brk\"],\n      \"break\": true,\n    };\n\n    if (_.has(options, \"inspect\")) {\n      console.log(\n        \"Both --inspect and --inspect-brk provided; \" +\n          \"ignoring --inspect.\"\n      );\n\n      delete options.inspect;\n    }\n\n  } else if (_.has(options, \"inspect\")) {\n    result.inspect = {\n      port: options.inspect,\n      \"break\": false,\n    };\n  }\n\n  return result;\n}\n\nvar runCommandOptions = {\n  requiresApp: true,\n  maxArgs: Infinity,\n  options: {\n    port: { type: String, short: \"p\", default: DEFAULT_PORT },\n    'mobile-server': { type: String },\n    'cordova-server-port': { type: String },\n    // XXX COMPAT WITH 0.9.2.2\n    'mobile-port': { type: String },\n    'app-port': { type: String },\n    'debug-port': { type: String },\n    ...inspectOptions,\n    'no-release-check': { type: Boolean },\n    production: { type: Boolean },\n    'raw-logs': { type: Boolean },\n    settings: { type: String, short: \"s\" },\n    verbose: { type: Boolean, short: \"v\" },\n    // With --once, meteor does not re-run the project if it crashes\n    // and does not monitor for file changes. Intentionally\n    // undocumented: intended for automated testing (eg, cli-test.sh),\n    // not end-user use. #Once\n    once: { type: Boolean },\n    // Don't run linter on rebuilds\n    'no-lint': { type: Boolean },\n    // Allow the version solver to make breaking changes to the versions\n    // of top-level dependencies.\n    'allow-incompatible-update': { type: Boolean },\n    'extra-packages': { type: String },\n    'exclude-archs': { type: String }\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n};\n\nmain.registerCommand(_.extend(\n  { name: 'run' },\n  runCommandOptions\n), doRunCommand);\n\nfunction doRunCommand(options) {\n  Console.setVerbose(!!options.verbose);\n\n  // Additional args are interpreted as run targets\n  const runTargets = parseRunTargets(options.args);\n\n  const { parsedServerUrl, parsedMobileServerUrl, parsedCordovaServerPort } =\n    parseServerOptionsForRunCommand(options, runTargets);\n\n  var includePackages = [];\n  if (options['extra-packages']) {\n    includePackages = options['extra-packages'].trim().split(/\\s*,\\s*/);\n  }\n\n  var projectContext = new projectContextModule.ProjectContext({\n    projectDir: options.appDir,\n    allowIncompatibleUpdate: options['allow-incompatible-update'],\n    lintAppAndLocalPackages: !options['no-lint'],\n    includePackages: includePackages,\n  });\n\n  main.captureAndExit(\"=> Errors while initializing project:\", function () {\n    // We're just reading metadata here --- we'll wait to do the full build\n    // preparation until after we've started listening on the proxy, etc.\n    projectContext.readProjectMetadata();\n  });\n\n  if (release.explicit) {\n    if (release.current.name !== projectContext.releaseFile.fullReleaseName) {\n      console.log(\"=> Using %s as requested (overriding %s)\",\n                  release.current.getDisplayName(),\n                  projectContext.releaseFile.displayReleaseName);\n      console.log();\n    }\n  }\n\n  let appHost, appPort;\n  if (options['app-port']) {\n    var appPortMatch = options['app-port'].match(/^(?:(.+):)?([0-9]+)?$/);\n    if (!appPortMatch) {\n      Console.error(\n        \"run: --app-port must be a number or be of the form 'host:port' \",\n        \"where port is a number. Try\",\n        Console.command(\"'meteor help run'\") + \" for help.\");\n      return 1;\n    }\n    appHost = appPortMatch[1] || null;\n    // It's legit to specify `--app-port host:` and still let the port be\n    // randomized.\n    appPort = appPortMatch[2] ? parseInt(appPortMatch[2]) : null;\n  }\n\n  if (options.production) {\n    Console.warn(\n      \"Warning: The --production flag should only be used to simulate production \" +\n      \"bundling for testing purposes. Use meteor build to create a bundle for \" +\n      \"production deployment. See: https://guide.meteor.com/deployment.html\"\n    );\n  }\n\n  if (options['raw-logs']) {\n    runLog.setRawLogs(true);\n  }\n\n  let webArchs = projectContext.platformList.getWebArchs();\n  if (! _.isEmpty(runTargets) ||\n      options['mobile-server']) {\n    if (webArchs.indexOf(\"web.cordova\") < 0) {\n      webArchs.push(\"web.cordova\");\n    }\n  }\n  webArchs = filterWebArchs(webArchs, options['exclude-archs']);\n\n  let cordovaRunner;\n  if (!_.isEmpty(runTargets)) {\n\n    function prepareCordovaProject() {\n      import { CordovaProject } from '../cordova/project.js';\n\n      main.captureAndExit('', 'preparing Cordova project', () => {\n        const cordovaProject = new CordovaProject(projectContext, {\n          settingsFile: options.settings,\n          mobileServerUrl: utils.formatUrl(parsedMobileServerUrl),\n          cordovaServerPort: parsedCordovaServerPort });\n        if (buildmessage.jobHasMessages()) return;\n\n        cordovaRunner = new CordovaRunner(cordovaProject, runTargets);\n        cordovaRunner.checkPlatformsForRunTargets();\n      });\n    }\n\n    ensureDevBundleDependencies();\n    prepareCordovaProject();\n  }\n\n  var runAll = require('../runners/run-all.js');\n  return runAll.run({\n    projectContext: projectContext,\n    proxyPort: parsedServerUrl.port,\n    proxyHost: parsedServerUrl.hostname,\n    appPort: appPort,\n    appHost: appHost,\n    ...normalizeInspectOptions(options),\n    settingsFile: options.settings,\n    buildOptions: {\n      minifyMode: options.production ? 'production' : 'development',\n      buildMode: options.production ? 'production' : 'development',\n      webArchs: webArchs\n    },\n    rootUrl: process.env.ROOT_URL,\n    mongoUrl: process.env.MONGO_URL,\n    oplogUrl: process.env.MONGO_OPLOG_URL,\n    mobileServerUrl: utils.formatUrl(parsedMobileServerUrl),\n    cordovaServerPort: parsedCordovaServerPort,\n    once: options.once,\n    noReleaseCheck: options['no-release-check'] || process.env.METEOR_NO_RELEASE_CHECK,\n    cordovaRunner: cordovaRunner\n  });\n}\n\n///////////////////////////////////////////////////////////////////////////////\n// debug\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand(_.extend(\n  { name: 'debug' },\n  runCommandOptions\n), function (options) {\n  options[\"inspect-brk\"] = options[\"inspect-brk\"] || \"9229\";\n  return doRunCommand(options);\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// shell\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'shell',\n  requiresRelease: false,\n  requiresApp: true,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  if (!options.appDir) {\n    Console.error(\n      \"The \" + Console.command(\"'meteor shell'\") + \" command must be run\",\n      \"in a Meteor app directory.\"\n    );\n  } else {\n    var projectContext = new projectContextModule.ProjectContext({\n      projectDir: options.appDir\n    });\n\n    // Convert to OS path here because shell/server.js doesn't know how to\n    // convert paths, since it exists in the app and in the tool.\n    require('../shell-client').connect(\n      files.convertToOSPath(projectContext.getMeteorShellDirectory())\n    );\n\n    throw new main.WaitForExit;\n  }\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// create\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'create',\n  maxArgs: 1,\n  options: {\n    list: { type: Boolean },\n    example: { type: String },\n    package: { type: Boolean },\n    bare: { type: Boolean },\n    minimal: { type: Boolean },\n    full: { type: Boolean },\n    react: { type: Boolean },\n    vue: { type: Boolean },\n    typescript: { type: Boolean },\n    apollo: { type: Boolean },\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n\n  // Creating a package is much easier than creating an app, so if that's what\n  // we are doing, do that first. (For example, we don't springboard to the\n  // latest release to create a package if we are inside an app)\n  if (options.package) {\n    var packageName = options.args[0];\n\n    if (options.list || options.example) {\n      Console.error(\"No package examples exist at this time.\");\n      Console.error();\n      throw new main.ShowUsage;\n    }\n\n    if (!packageName) {\n      Console.error(\"Please specify the name of the package.\");\n      throw new main.ShowUsage;\n    }\n\n    utils.validatePackageNameOrExit(\n      packageName, {detailedColonExplanation: true});\n\n    // When we create a package, avoid introducing a colon into the file system\n    // by naming the directory after the package name without the prefix.\n    var fsName = packageName;\n    if (packageName.indexOf(\":\") !== -1) {\n      var split = packageName.split(\":\");\n\n      if (split.length > 2) {\n        // It may seem like this check should be inside package version parser's\n        // validatePackageName, but we decided to name test packages like this:\n        // local-test:prefix:name, so we have to support building packages\n        // with at least two colons. Therefore we will at least try to\n        // discourage people from putting a ton of colons in their package names\n        // here.\n        Console.error(packageName +\n          \": Package names may not have more than one colon.\");\n        return 1;\n      }\n\n      fsName = split[1];\n    }\n\n    var packageDir;\n    if (options.appDir) {\n      packageDir = files.pathResolve(options.appDir, 'packages', fsName);\n    } else {\n      packageDir = files.pathResolve(fsName);\n    }\n\n    var inYourApp = options.appDir ? \" in your app\" : \"\";\n\n    if (files.exists(packageDir)) {\n      Console.error(packageName + \": Already exists\" + inYourApp);\n      return 1;\n    }\n\n    var transform = function (x) {\n      var xn =\n        x.replace(/~name~/g, packageName).replace(/~fs-name~/g, fsName);\n\n      // If we are running from checkout, comment out the line sourcing packages\n      // from a release, with the latest release filled in (in case they do want\n      // to publish later). If we are NOT running from checkout, fill it out\n      // with the current release.\n      var relString;\n      if (release.current.isCheckout()) {\n        xn = xn.replace(/~cc~/g, \"//\");\n        var rel = catalog.official.getDefaultReleaseVersion();\n        // the no-release case should never happen except in tests.\n        relString = rel ? rel.version : \"no-release\";\n      } else {\n        xn = xn.replace(/~cc~/g, \"\");\n        relString = release.current.getDisplayName({noPrefix: true});\n      }\n\n      // If we are not in checkout, write the current release here.\n      return xn.replace(/~release~/g, relString);\n    };\n\n    try {\n      files.cp_r(files.pathJoin(__dirnameConverted, '..', 'static-assets', 'skel-pack'), packageDir, {\n        transformFilename: function (f) {\n          return transform(f);\n        },\n        transformContents: function (contents, f) {\n          if ((/(\\.html|\\.[jt]sx?|\\.css)/).test(f)) {\n            return Buffer.from(transform(contents.toString()));\n          } else {\n            return contents;\n          }\n        },\n        ignore: [/^local$/],\n        preserveSymlinks: true,\n      });\n    } catch (err) {\n      Console.error(\"Could not create package: \" + err.message);\n      return 1;\n    }\n\n    var displayPackageDir =\n      files.convertToOSPath(files.pathRelative(files.cwd(), packageDir));\n\n    // Since the directory can't have colons, the directory name will often not\n    // match the name of the package exactly, therefore we should tell people\n    // where it was created.\n    Console.info(\n      packageName + \": created in\",\n      Console.path(displayPackageDir)\n    );\n\n    return 0;\n  }\n\n  // Suppose you have an app A, and from some directory inside that\n  // app, you run 'meteor create /my/new/app'. The new app should use\n  // the latest available Meteor release, not the release that A\n  // uses. So if we were run from inside an app directory, and the\n  // user didn't force a release with --release, we need to\n  // springboard to the correct release and tools version.\n  //\n  // (In particular, it's not sufficient to create the new app with\n  // this version of the tools, and then stamp on the correct release\n  // at the end.)\n  if (! release.current.isCheckout() && !release.forced) {\n    if (release.current.name !== release.latestKnown()) {\n      throw new main.SpringboardToLatestRelease;\n    }\n  }\n\n  if (options.list) {\n    Console.info(\"Available examples:\");\n    _.each(EXAMPLE_REPOSITORIES, function (repoInfo, name) {\n      const branchInfo = repoInfo.branch ? `/tree/${repoInfo.branch}` : '';\n      Console.info(\n        Console.command(`${name}: ${repoInfo.repo}${branchInfo}`),\n        Console.options({ indent: 2 }));\n    });\n\n    Console.info();\n    Console.info(\"To create an example, simply\", Console.command(\"git clone\"),\n      \"the relevant repository and branch (run\",\n      Console.command(\"'meteor create --example <name>'\"),\n      \" to see the full command).\");\n    return 0;\n  };\n\n  if (options.example) {\n    const repoInfo = EXAMPLE_REPOSITORIES[options.example];\n    if (!repoInfo) {\n      Console.error(`${options.example}: no such example.`);\n      Console.error(\n        \"List available applications with\",\n        Console.command(\"'meteor create --list'\") + \".\");\n      return 1;\n    }\n\n    const branchOption = repoInfo.branch ? ` -b ${repoInfo.branch}` : '';\n    const path = options.args.length === 1 ? ` ${options.args[0]}` : '';\n\n    Console.info(`To create the ${options.example} example, please run:`);\n    Console.info(\n      Console.command(`git clone ${repoInfo.repo}${branchOption}${path}`),\n      Console.options({ indent: 2 }));\n\n    return 0;\n  }\n\n  var appPathAsEntered;\n  if (options.args.length === 1) {\n    appPathAsEntered = options.args[0];\n  } else {\n    throw new main.ShowUsage;\n  }\n  var appPath = files.pathResolve(appPathAsEntered);\n\n  if (files.findAppDir(appPath)) {\n    Console.error(\n      \"You can't create a Meteor project inside another Meteor project.\");\n    return 1;\n  }\n\n  var appName;\n  if (appPathAsEntered === \".\" || appPathAsEntered === \"./\") {\n    // If trying to create in current directory\n    appName = files.pathBasename(files.cwd());\n  } else {\n    appName = files.pathBasename(appPath);\n  }\n\n\n  var transform = function (x) {\n    return x.replace(/~name~/g, appName);\n  };\n\n  // These file extensions are usually metadata, not app code\n  var nonCodeFileExts = ['.txt', '.md', '.json', '.sh'];\n\n  var destinationHasCodeFiles = false;\n\n  // If the directory doesn't exist, it clearly doesn't have any source code\n  // inside itself\n  if (files.exists(appPath)) {\n    destinationHasCodeFiles = _.any(files.readdir(appPath),\n        function thisPathCountsAsAFile(filePath) {\n      // We don't mind if there are hidden files or directories (this includes\n      // .git) and we don't need to check for .meteor here because the command\n      // will fail earlier\n      var isHidden = /^\\./.test(filePath);\n      if (isHidden) {\n        // Not code\n        return false;\n      }\n\n      // We do mind if there are non-hidden directories, because we don't want\n      // to recursively check everything to do some crazy heuristic to see if\n      // we should try to create an app.\n      var stats = files.stat(files.pathJoin(appPath, filePath));\n      if (stats.isDirectory()) {\n        // Could contain code\n        return true;\n      }\n\n      // Check against our file extension white list\n      var ext = files.pathExtname(filePath);\n      if (ext == '' || _.contains(nonCodeFileExts, ext)) {\n        return false;\n      }\n\n      // Everything not matched above is considered to be possible source code\n      return true;\n    });\n  }\n\n  var toIgnore = [/^local$/, /^\\.id$/];\n  if (destinationHasCodeFiles) {\n    // If there is already source code in the directory, don't copy our\n    // skeleton app code over it. Just create the .meteor folder and metadata\n    toIgnore.push(/(\\.html|\\.js|\\.css)/);\n  }\n\n  let skelName = \"skel\";\n  if (options.minimal) {\n    skelName += \"-minimal\";\n  } else if (options.bare) {\n    skelName += \"-bare\";\n  } else if (options.full) {\n    skelName += \"-full\";\n  } else if (options.react) {\n    skelName += \"-react\";\n  } else if (options.vue) {\n    skelName += \"-vue\";\n  } else if (options.typescript) {\n    skelName += \"-typescript\";\n  } else if (options.apollo) {\n    skelName += \"-apollo\";\n  }\n\n  files.cp_r(files.pathJoin(__dirnameConverted, '..', 'static-assets', skelName), appPath, {\n    transformFilename: function (f) {\n      return transform(f);\n    },\n    transformContents: function (contents, f) {\n      if ((/(\\.html|\\.[jt]sx?|\\.css)/).test(f)) {\n        return Buffer.from(transform(contents.toString()));\n      } else {\n        return contents;\n      }\n    },\n    ignore: toIgnore,\n    preserveSymlinks: true,\n  });\n\n  // We are actually working with a new meteor project at this point, so\n  // set up its context.\n  var projectContext = new projectContextModule.ProjectContext({\n    projectDir: appPath,\n    // Write .meteor/versions even if --release is specified.\n    alwaysWritePackageMap: true,\n    // examples come with a .meteor/versions file, but we shouldn't take it\n    // too seriously\n    allowIncompatibleUpdate: true\n  });\n\n  main.captureAndExit(\"=> Errors while creating your project\", function () {\n    projectContext.readProjectMetadata();\n    if (buildmessage.jobHasMessages()) {\n      return;\n    }\n\n    projectContext.releaseFile.write(\n      release.current.isCheckout() ? \"none\" : release.current.name);\n    if (buildmessage.jobHasMessages()) {\n      return;\n    }\n\n    // Also, write package version constraints from the current release\n    // If we are on a checkout, we don't need to do this as running from\n    // checkout still pins all package versions and if the user updates\n    // to a real release, the packages file will subsequently get updated\n    if (!release.current.isCheckout()) {\n      projectContext.projectConstraintsFile\n        .updateReleaseConstraints(release.current._manifest);\n    }\n\n    // Any upgrader that is in this version of Meteor doesn't need to be run on\n    // this project.\n    var upgraders = require('../upgraders.js');\n    projectContext.finishedUpgraders.appendUpgraders(upgraders.allUpgraders());\n\n    projectContext.prepareProjectForBuild();\n  });\n  // No need to display the PackageMapDelta here, since it would include all of\n  // the packages (or maybe an unpredictable subset based on what happens to be\n  // in the template's versions file).\n\n  // Since some of the project skeletons include npm `devDependencies`, we need\n  // to make sure they're included when running `npm install`.\n  require(\"./default-npm-deps.js\").install(\n    appPath,\n    { includeDevDependencies: true }\n  );\n\n  var appNameToDisplay = appPathAsEntered === \".\" ?\n    \"current directory\" : `'${appPathAsEntered}'`;\n\n  var message = `Created a new Meteor app in ${appNameToDisplay}`;\n\n  message += \".\";\n\n  Console.info(message + \"\\n\");\n\n  // Print a nice message telling people we created their new app, and what to\n  // do next.\n  Console.info(\"To run your new app:\");\n\n  function cmd(text) {\n    Console.info(Console.command(text), Console.options({\n      indent: 2\n    }));\n  }\n\n  if (appPathAsEntered !== \".\") {\n    // Wrap the app path in quotes if it contains spaces\n    const appPathWithQuotesIfSpaces = appPathAsEntered.indexOf(' ') === -1 ?\n      appPathAsEntered :\n      `'${appPathAsEntered}'`;\n\n    // Don't tell people to 'cd .'\n    cmd(\"cd \" + appPathWithQuotesIfSpaces);\n  }\n\n  cmd(\"meteor\");\n\n  Console.info(\"\");\n  Console.info(\"If you are new to Meteor, try some of the learning resources here:\");\n  Console.info(\n    Console.url(\"https://www.meteor.com/tutorials\"),\n      Console.options({ indent: 2 }));\n\n  Console.info(\"\");\n  Console.info(\"When you’re ready to deploy and host your new Meteor application, check out Galaxy:\");\n  Console.info(\n    Console.url(\"https://www.meteor.com/hosting\"),\n      Console.options({ indent: 2 }));\n\n  if (! options.bare &&\n      ! options.minimal &&\n      ! options.full &&\n      ! options.react &&\n      ! options.vue &&\n      ! options.typescript) {\n    // Notify people about --bare, --minimal, --full, --react, --vue, --apollo and --typescript.\n    Console.info([\n      \"\",\n      \"To start with a different app template, try one of the following:\",\n      \"\",\n    ].join(\"\\n\"));\n\n    cmd(\"meteor create --bare       # to create an empty app\");\n    cmd(\"meteor create --minimal    # to create an app with as few Meteor packages as possible\");\n    cmd(\"meteor create --full       # to create a more complete scaffolded app\");\n    cmd(\"meteor create --react      # to create a basic React-based app\");\n    cmd(\"meteor create --vue        # to create a basic Vue-based app\");\n    cmd(\"meteor create --apollo     # to create a basic Apollo + React app\");\n    cmd(\"meteor create --typescript # to create an app using TypeScript and React\");\n  }\n\n  Console.info(\"\");\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// build\n///////////////////////////////////////////////////////////////////////////////\n\nvar buildCommands = {\n  minArgs: 1,\n  maxArgs: 1,\n  requiresApp: true,\n  options: {\n    debug: { type: Boolean },\n    directory: { type: Boolean },\n    architecture: { type: String },\n    \"server-only\": { type: Boolean },\n    'mobile-settings': { type: String },\n    server: { type: String },\n    \"cordova-server-port\": { type: String },\n    // XXX COMPAT WITH 0.9.2.2\n    \"mobile-port\": { type: String },\n    // Indicates whether these build is running headless, e.g. in a\n    // continuous integration building environment, where visual niceties\n    // like progress bars and spinners are unimportant.\n    headless: { type: Boolean },\n    verbose: { type: Boolean, short: \"v\" },\n    'allow-incompatible-update': { type: Boolean }\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n};\n\nmain.registerCommand({\n  name: \"build\",\n  ...buildCommands,\n}, async function (options) {\n  return Profile.run(\n    \"meteor build\",\n    () => Promise.await(buildCommand(options))\n  );\n});\n\n// Deprecated -- identical functionality to 'build' with one exception: it\n// doesn't output a directory with all builds but rather only one tarball with\n// server/client programs.\n// XXX COMPAT WITH 0.9.1.1\nmain.registerCommand({\n  name: \"bundle\",\n  hidden: true,\n  ...buildCommands,\n}, async function (options) {\n  Console.error(\n    \"This command has been deprecated in favor of \" +\n    Console.command(\"'meteor build'\") + \", which allows you to \" +\n    \"build for multiple platforms and outputs a directory instead of \" +\n    \"a single tarball. See \" + Console.command(\"'meteor help build'\") + \" \" +\n    \"for more information.\");\n  Console.error();\n\n  return Profile.run(\n    \"meteor bundle\",\n    () => Promise.await(buildCommand({\n      ...options,\n      _bundleOnly: true,\n    }))\n  );\n});\n\nvar buildCommand = function (options) {\n  Console.setVerbose(!!options.verbose);\n  if (options.headless) {\n    // There's no point in spinning the spinner when we're running\n    // automated builds.\n    Console.setHeadless(true);\n  }\n  // XXX output, to stderr, the name of the file written to (for human\n  // comfort, especially since we might change the name)\n\n  // XXX name the root directory in the bundle based on the basename\n  // of the file, not a constant 'bundle' (a bit obnoxious for\n  // machines, but worth it for humans)\n\n  // Error handling for options.architecture. See archinfo for more\n  // information on what the architectures are, what they mean, et cetera.\n  if (options.architecture &&\n      !_.has(archinfo.VALID_ARCHITECTURES, options.architecture)) {\n    showInvalidArchMsg(options.architecture);\n    return 1;\n  }\n  var bundleArch = options.architecture || archinfo.host();\n\n  var projectContext = new projectContextModule.ProjectContext({\n    projectDir: options.appDir,\n    serverArchitectures: _.uniq([bundleArch, archinfo.host()]),\n    allowIncompatibleUpdate: options['allow-incompatible-update']\n  });\n\n  main.captureAndExit(\"=> Errors while initializing project:\", function () {\n    // TODO Fix the nested Profile.run warning here, without interfering\n    // with METEOR_PROFILE output for other commands, like `meteor run`.\n    projectContext.prepareProjectForBuild();\n  });\n  projectContext.packageMapDelta.displayOnConsole();\n\n  // _bundleOnly implies serverOnly\n  const serverOnly = options._bundleOnly || !!options['server-only'];\n\n  // options['mobile-settings'] is used to set the initial value of\n  // `Meteor.settings` on mobile apps. Pass it on to options.settings,\n  // which is used in this command.\n  if (options['mobile-settings']) {\n    options.settings = options['mobile-settings'];\n  }\n\n  const appName = files.pathBasename(options.appDir);\n\n  let cordovaPlatforms;\n  let parsedMobileServerUrl;\n  let parsedCordovaServerPort;\n  if (!serverOnly) {\n    cordovaPlatforms = projectContext.platformList.getCordovaPlatforms();\n\n    if (process.platform !== 'darwin' && _.contains(cordovaPlatforms, 'ios')) {\n      cordovaPlatforms = _.without(cordovaPlatforms, 'ios');\n      Console.warn(\"Currently, it is only possible to build iOS apps \\\non an OS X system.\");\n    }\n\n    if (!_.isEmpty(cordovaPlatforms)) {\n      // XXX COMPAT WITH 0.9.2.2 -- the --mobile-port option is deprecated\n      const mobileServerOption = options.server || options[\"mobile-port\"];\n      if (!mobileServerOption) {\n        // For Cordova builds, require '--server'.\n        // XXX better error message?\n        Console.error(\n          \"Supply the server hostname and port in the --server option \" +\n            \"for mobile app builds.\");\n        return 1;\n      }\n      parsedMobileServerUrl = parseMobileServerOption(mobileServerOption,\n        'server');\n      parsedCordovaServerPort = parseCordovaServerPortOption(options);\n    }\n  } else {\n    cordovaPlatforms = [];\n  }\n\n  var buildDir = projectContext.getProjectLocalDirectory('build_tar');\n  var outputPath = files.pathResolve(options.args[0]); // get absolute path\n\n  // Warn if people try to build inside the app directory.\n  var relative = files.pathRelative(options.appDir, outputPath);\n  // We would like the output path to be outside the app directory, which\n  // means the first step to getting there is going up a level.\n  if (relative.substr(0, 2) !== '..') {\n    Console.warn();\n    Console.labelWarn(`The output directory is under your source tree.\nYour generated files may get interpreted as source code!\nConsider building into a different directory instead\n${Console.command(\"meteor build ../output\")}`,\n      Console.options({ indent: 2 }));\n    Console.warn();\n  }\n\n  var bundlePath = options.directory ?\n      (options._bundleOnly ? outputPath :\n      files.pathJoin(outputPath, 'bundle')) :\n      files.pathJoin(buildDir, 'bundle');\n\n  stats.recordPackages({\n    what: \"sdk.bundle\",\n    projectContext: projectContext\n  });\n\n  var bundler = require('../isobuild/bundler.js');\n  var bundleResult = bundler.bundle({\n    projectContext: projectContext,\n    outputPath: bundlePath,\n    buildOptions: {\n      minifyMode: options.debug ? 'development' : 'production',\n      // XXX is this a good idea, or should linux be the default since\n      //     that's where most people are deploying\n      //     default?  i guess the problem with using DEPLOY_ARCH as default\n      //     is then 'meteor bundle' with no args fails if you have any local\n      //     packages with binary npm dependencies\n      serverArch: bundleArch,\n      buildMode: options.debug ? 'development' : 'production',\n    },\n  });\n  if (bundleResult.errors) {\n    Console.error(\"Errors prevented bundling:\");\n    Console.error(bundleResult.errors.formatMessages());\n    return 1;\n  }\n\n  if (!options._bundleOnly) {\n    files.mkdir_p(outputPath);\n  }\n\n  if (!options.directory) {\n    main.captureAndExit('', 'creating server tarball', () => {\n      try {\n        var outputTar = options._bundleOnly ? outputPath :\n          files.pathJoin(outputPath, appName + '.tar.gz');\n\n        files.createTarball(files.pathJoin(buildDir, 'bundle'), outputTar);\n      } catch (err) {\n        buildmessage.exception(err);\n        files.rm_recursive(buildDir);\n      }\n    });\n  }\n\n  if (!_.isEmpty(cordovaPlatforms)) {\n\n    let cordovaProject;\n    main.captureAndExit('', () => {\n\n      import {\n        pluginVersionsFromStarManifest,\n        displayNameForPlatform,\n      } from '../cordova/index.js';\n\n      ensureDevBundleDependencies();\n\n      buildmessage.enterJob({ title: \"preparing Cordova project\" }, () => {\n        import { CordovaProject } from '../cordova/project.js';\n\n        cordovaProject = new CordovaProject(projectContext, {\n          settingsFile: options.settings,\n          mobileServerUrl: utils.formatUrl(parsedMobileServerUrl),\n          cordovaServerPort: parsedCordovaServerPort });\n        if (buildmessage.jobHasMessages()) return;\n\n        const pluginVersions = pluginVersionsFromStarManifest(\n          bundleResult.starManifest);\n\n        cordovaProject.prepareFromAppBundle(bundlePath, pluginVersions);\n      });\n\n      for (platform of cordovaPlatforms) {\n        buildmessage.enterJob(\n          { title: `building Cordova app for \\\n${displayNameForPlatform(platform)}` }, () => {\n            let buildOptions = { release: !options.debug };\n\n            const buildPath = files.pathJoin(\n              projectContext.getProjectLocalDirectory('cordova-build'),\n              'platforms', platform);\n            const platformOutputPath = files.pathJoin(outputPath, platform);\n\n            // Prepare the project once again to ensure that it is up to date\n            // with current build options.  For example, --server=example.com\n            // is utilized in the Cordova builder to write boilerplate HTML and\n            // various config.xml settings (e.g. access policies)\n            if (platform === 'ios') {\n              cordovaProject.prepareForPlatform(platform, buildOptions);\n            } else if (platform === 'android') {\n              cordovaProject.buildForPlatform(platform, buildOptions);\n            }\n\n            // Once prepared, copy the bundle to the final location.\n            files.cp_r(buildPath,\n              files.pathJoin(platformOutputPath, 'project'));\n\n            // Make some platform-specific adjustments to the resulting build.\n            if (platform === 'ios') {\n              files.writeFile(\n                files.pathJoin(platformOutputPath, 'README'),\n`This is an auto-generated XCode project for your iOS application.\n\nInstructions for publishing your iOS app to App Store can be found at:\nhttps://guide.meteor.com/cordova.html#submitting-ios\n`, \"utf8\");\n            } else if (platform === 'android') {\n              const apkPath = files.pathJoin(buildPath, 'build/outputs/apk',\n                options.debug ? 'android-debug.apk' : 'android-release-unsigned.apk');\n\n              if (files.exists(apkPath)) {\n              files.copyFile(apkPath, files.pathJoin(platformOutputPath,\n                options.debug ? 'debug.apk' : 'release-unsigned.apk'));\n              }\n\n              files.writeFile(\n                files.pathJoin(platformOutputPath, 'README'),\n`This is an auto-generated Gradle project for your Android application.\n\nInstructions for publishing your Android app to Play Store can be found at:\nhttps://guide.meteor.com/cordova.html#submitting-android\n`, \"utf8\");\n            }\n        });\n      }\n    });\n  }\n\n  files.rm_recursive(buildDir);\n};\n\n///////////////////////////////////////////////////////////////////////////////\n// lint\n///////////////////////////////////////////////////////////////////////////////\nmain.registerCommand({\n  name: 'lint',\n  maxArgs: 0,\n  requiresAppOrPackage: true,\n  options: {\n    'allow-incompatible-updates': { type: Boolean }\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  const {packageDir, appDir} = options;\n\n  let projectContext = null;\n\n  // if the goal is to lint the package, don't include the whole app\n  if (packageDir) {\n    // similar to `meteor publish`, create a fake project\n    const tempProjectDir = files.mkdtemp('meteor-package-build');\n    projectContext = new projectContextModule.ProjectContext({\n      projectDir: tempProjectDir,\n      explicitlyAddedLocalPackageDirs: [packageDir],\n      packageMapFilename: files.pathJoin(packageDir, '.versions'),\n      alwaysWritePackageMap: true,\n      forceIncludeCordovaUnibuild: true,\n      allowIncompatibleUpdate: options['allow-incompatible-update'],\n      lintPackageWithSourceRoot: packageDir\n    });\n\n    main.captureAndExit(\"=> Errors while setting up package:\", () =>\n      // Read metadata and initialize catalog.\n      projectContext.initializeCatalog()\n    );\n    const versionRecord =\n        projectContext.localCatalog.getVersionBySourceRoot(packageDir);\n    if (! versionRecord) {\n      throw Error(\"explicitly added local package dir missing?\");\n    }\n    const packageName = versionRecord.packageName;\n    const constraint = utils.parsePackageConstraint(packageName);\n    projectContext.projectConstraintsFile.removeAllPackages();\n    projectContext.projectConstraintsFile.addConstraints([constraint]);\n  }\n\n  // linting the app\n  if (! projectContext && appDir) {\n    projectContext = new projectContextModule.ProjectContext({\n      projectDir: appDir,\n      serverArchitectures: [archinfo.host()],\n      allowIncompatibleUpdate: options['allow-incompatible-update'],\n      lintAppAndLocalPackages: true\n    });\n  }\n\n\n  main.captureAndExit(\"=> Errors prevented the build:\", () => {\n    projectContext.prepareProjectForBuild();\n  });\n\n  const bundler = require('../isobuild/bundler.js');\n  const bundle = bundler.bundle({\n    projectContext: projectContext,\n    outputPath: null,\n    buildOptions: {\n      minifyMode: 'development'\n    }\n  });\n\n  const displayName = options.packageDir ? 'package' : 'app';\n  if (bundle.errors) {\n    Console.error(\n      `=> Errors building your ${displayName}:\\n\\n${bundle.errors.formatMessages()}`\n    );\n    throw new main.ExitWithCode(2);\n  }\n\n  if (bundle.warnings) {\n    Console.warn(bundle.warnings.formatMessages());\n    return 1;\n  }\n\n  return 0;\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// mongo\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'mongo',\n  maxArgs: 1,\n  options: {\n    url: { type: Boolean, short: 'U' }\n  },\n  requiresApp: function (options) {\n    return options.args.length === 0;\n  },\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  var mongoUrl;\n  var usedMeteorAccount = false;\n\n  if (options.args.length === 0) {\n    // localhost mode\n    var findMongoPort =\n      require('../runners/run-mongo.js').findMongoPort;\n    var mongoPort = findMongoPort(files.pathJoin(options.appDir, \".meteor\", \"local\", \"db\"));\n\n    // XXX detect the case where Meteor is running, but MONGO_URL was\n    // specified?\n\n    if (! mongoPort) {\n      Console.info(\"mongo: Meteor isn't running a local MongoDB server.\");\n      Console.info();\n      Console.info(`\\\nThis command only works while Meteor is running your application locally. \\\nStart your application first with 'meteor' and then run this command in a new \\\nterminal. This error will also occur if you asked Meteor to use a different \\\nMongoDB server with $MONGO_URL when you ran your application.`);\n      Console.info();\n      Console.info(`\\\nIf you're trying to connect to the database of an app you deployed with \\\n${Console.command(\"'meteor deploy'\")}, specify your site's name as an argument \\\nto this command.`);\n      return 1;\n    }\n    mongoUrl = \"mongodb://127.0.0.1:\" + mongoPort + \"/meteor\";\n\n  } else {\n    // remote mode\n    var site = qualifySitename(options.args[0]);\n\n    mongoUrl = deploy.temporaryMongoUrl(site);\n    usedMeteorAccount = true;\n\n    if (! mongoUrl) {\n      // temporaryMongoUrl() will have printed an error message\n      return 1;\n    }\n  }\n  if (options.url) {\n    console.log(mongoUrl);\n  } else {\n    if (usedMeteorAccount) {\n      auth.maybePrintRegistrationLink();\n    }\n    process.stdin.pause();\n    var runMongo = require('../runners/run-mongo.js');\n    runMongo.runMongoShell(mongoUrl);\n    throw new main.WaitForExit;\n  }\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// reset\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'reset',\n  // Doesn't actually take an argument, but we want to print an custom\n  // error message if they try to pass one.\n  maxArgs: 1,\n  requiresApp: true,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  if (options.args.length !== 0) {\n    Console.error(\"meteor reset only affects the locally stored database.\");\n    Console.error();\n    Console.error(\"To reset a deployed application use\");\n    Console.error(\n      Console.command(\"meteor deploy --delete appname\"), Console.options({ indent: 2 }));\n    Console.error(\"followed by\");\n    Console.error(\n      Console.command(\"meteor deploy appname\"), Console.options({ indent: 2 }));\n    return 1;\n  }\n\n  if (process.env.MONGO_URL) {\n    Console.info(\"As a precaution, meteor reset only clears the local database that is \" +\n                 \"provided by meteor run for development. The database specified with \" +\n                 \"MONGO_URL will NOT be reset.\");\n  }\n\n  // XXX detect the case where Meteor is running the app, but\n  // MONGO_URL was set, so we don't see a Mongo process\n  var findMongoPort = require('../runners/run-mongo.js').findMongoPort;\n  var isRunning = !! findMongoPort(files.pathJoin(options.appDir, \".meteor\", \"local\", \"db\"));\n  if (isRunning) {\n    Console.error(\"reset: Meteor is running.\");\n    Console.error();\n    Console.error(\n      \"This command does not work while Meteor is running your application.\",\n      \"Exit the running Meteor development server.\");\n    return 1;\n  }\n\n  return files.rm_recursive_async(\n    files.pathJoin(options.appDir, '.meteor', 'local')\n  ).then(() => {\n    Console.info(\"Project reset.\");\n  });\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// deploy\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'deploy',\n  minArgs: 1,\n  maxArgs: 1,\n  options: {\n    'delete': { type: Boolean, short: 'D' },\n    debug: { type: Boolean },\n    settings: { type: String, short: 's' },\n    // No longer supported, but we still parse it out so that we can\n    // print a custom error message.\n    password: { type: String },\n    // Override architecture to deploy whatever stuff we have locally, even if\n    // it contains binary packages that should be incompatible. A hack to allow\n    // people to deploy from checkout or do other weird shit. We are not\n    // responsible for the consequences.\n    'override-architecture-with-local' : { type: Boolean },\n    'allow-incompatible-update': { type: Boolean },\n    'deploy-polling-timeout': { type: Number },\n    'no-wait': { type: Boolean },\n    'cache-build': { type: Boolean },\n  },\n  allowUnrecognizedOptions: true,\n  requiresApp: function (options) {\n    return ! options.delete;\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n}, async function (...args) {\n  return Profile.run(\n    \"meteor deploy\",\n    () => Promise.await(deployCommand(...args))\n  );\n});\n\nfunction deployCommand(options, { rawOptions }) {\n  var site = options.args[0];\n\n  if (options.delete) {\n    return deploy.deleteApp(site);\n  }\n\n  if (options.password) {\n    Console.error(\n      \"Setting passwords on apps is no longer supported. Now there are \" +\n        \"user accounts and your apps are associated with your account so \" +\n        \"that only you (and people you designate) can access them. See the \" +\n        Console.command(\"'meteor authorized'\") + \" command.\");\n    return 1;\n  }\n\n  var loggedIn = auth.isLoggedIn();\n  if (! loggedIn) {\n    Console.error(\n      \"You must be logged in to deploy, just enter your email address.\");\n    Console.error();\n    if (! auth.registerOrLogIn()) {\n      return 1;\n    }\n  }\n\n  // Override architecture iff applicable.\n  var buildArch = DEPLOY_ARCH;\n  if (options['override-architecture-with-local']) {\n    Console.warn();\n    Console.labelWarn(\n      \"OVERRIDING DEPLOY ARCHITECTURE WITH LOCAL ARCHITECTURE.\",\n      \"If your app contains binary code, it may break in unexpected \" +\n      \"and terrible ways.\");\n    buildArch = archinfo.host();\n  }\n\n  var projectContext = new projectContextModule.ProjectContext({\n    projectDir: options.appDir,\n    serverArchitectures: _.uniq([buildArch, archinfo.host()]),\n    allowIncompatibleUpdate: options['allow-incompatible-update']\n  });\n\n  main.captureAndExit(\"=> Errors while initializing project:\", function () {\n    // TODO Fix nested Profile.run warning here, too.\n    projectContext.prepareProjectForBuild();\n  });\n  projectContext.packageMapDelta.displayOnConsole();\n\n  var buildOptions = {\n    minifyMode: options.debug ? 'development' : 'production',\n    buildMode: options.debug ? 'development' : 'production',\n    serverArch: buildArch\n  };\n\n  let deployPollingTimeoutMs = null;\n  if (options['deploy-polling-timeout']) {\n    deployPollingTimeoutMs = options['deploy-polling-timeout'];\n  }\n\n  const isCacheBuildEnabled = !!options['cache-build'];\n  const waitForDeploy = !options['no-wait'];\n\n  var deployResult = deploy.bundleAndDeploy({\n    projectContext: projectContext,\n    site: site,\n    settingsFile: options.settings,\n    buildOptions: buildOptions,\n    rawOptions,\n    deployPollingTimeoutMs,\n    waitForDeploy,\n    isCacheBuildEnabled,\n  });\n\n  if (deployResult === 0) {\n    auth.maybePrintRegistrationLink({\n      leadingNewline: true,\n      // If the user was already logged in at the beginning of the\n      // deploy, then they've already been prompted to set a password\n      // at least once before, so we use a slightly different message.\n      firstTime: ! loggedIn\n    });\n  }\n\n  return deployResult;\n}\n\n///////////////////////////////////////////////////////////////////////////////\n// authorized\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'authorized',\n  minArgs: 1,\n  maxArgs: 1,\n  options: {\n    add: { type: String, short: \"a\" },\n    transfer: { type: String, short: \"t\" },\n    remove: { type: String, short: \"r\" },\n    list: { type: Boolean }\n  },\n  pretty: function (options) {\n    // pretty if we're mutating; plain if we're listing (which is more likely to\n    // be used by scripts)\n    return options.add || options.remove || options.transfer;\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n\n  if (_.keys(_.pick(options, 'add', 'remove', 'transfer', 'list')).length > 1) {\n    Console.error(\n      \"Sorry, you can only perform one authorization operation at a time.\");\n    return 1;\n  }\n\n  auth.pollForRegistrationCompletion();\n  var site = qualifySitename(options.args[0]);\n\n  if (! auth.isLoggedIn()) {\n    Console.error(\n      \"You must be logged in for that. Try \" +\n      Console.command(\"'meteor login'\"));\n    return 1;\n  }\n\n  if (options.add) {\n    return deploy.changeAuthorized(site, \"add\", options.add);\n  } else if (options.remove) {\n    return deploy.changeAuthorized(site, \"remove\", options.remove);\n  } else if (options.transfer) {\n    return deploy.changeAuthorized(site, \"transfer\", options.transfer);\n  } else {\n    return deploy.listAuthorized(site);\n  }\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// test and test-packages\n///////////////////////////////////////////////////////////////////////////////\n\ntestCommandOptions = {\n  maxArgs: Infinity,\n  catalogRefresh: new catalog.Refresh.Never(),\n  options: {\n    port: { type: String, short: \"p\", default: DEFAULT_PORT },\n    'mobile-server': { type: String },\n    'cordova-server-port': { type: String },\n    // XXX COMPAT WITH 0.9.2.2\n    'mobile-port': { type: String },\n    'debug-port': { type: String },\n    ...inspectOptions,\n    'no-release-check': { type: Boolean },\n    deploy: { type: String },\n    production: { type: Boolean },\n    settings: { type: String, short: 's' },\n    // Indicates whether these self-tests are running headless, e.g. in a\n    // continuous integration testing environment, where visual niceties\n    // like progress bars and spinners are unimportant.\n    headless: { type: Boolean },\n    verbose: { type: Boolean, short: \"v\" },\n    'raw-logs': { type: Boolean },\n\n    // Undocumented. See #Once\n    once: { type: Boolean },\n    // Undocumented. To ensure that QA covers both\n    // PollingObserveDriver and OplogObserveDriver, this option\n    // disables oplog for tests.  (It still creates a replset, it just\n    // doesn't do oplog tailing.)\n    'disable-oplog': { type: Boolean },\n    // Undocumented flag to use a different test driver.\n    'driver-package': { type: String },\n\n    // Sets the path of where the temp app should be created\n    'test-app-path': { type: String },\n\n    // Undocumented, runs tests under selenium\n    'selenium': { type: Boolean },\n    'selenium-browser': { type: String },\n\n    // Undocumented.  Usually we just show a banner saying 'Tests' instead of\n    // the ugly path to the temporary test directory, but if you actually want\n    // to see it you can ask for it.\n    'show-test-app-path': { type: Boolean },\n\n    // hard-coded options with all known Cordova platforms\n    ios: { type: Boolean },\n    'ios-device': { type: Boolean },\n    android: { type: Boolean },\n    'android-device': { type: Boolean },\n\n    // This could theoretically be useful/necessary in conjunction with\n    // --test-app-path.\n    'allow-incompatible-update': { type: Boolean },\n\n    // Don't print linting messages for tested packages\n    'no-lint': { type: Boolean },\n\n    // allow excluding packages when testing all packages.\n    // should be a comma-separated list of package names.\n    'exclude': { type: String },\n\n    // one of the following must be true\n    'test': { type: Boolean, 'default': false },\n    'test-packages': { type: Boolean, 'default': false },\n\n    // For 'test-packages': Run in \"full app\" mode\n    'full-app': { type: Boolean, 'default': false },\n\n    'extra-packages': { type: String },\n\n    'exclude-archs': { type: String }\n  }\n};\n\nmain.registerCommand(_.extend({\n  name: 'test',\n  requiresApp: true\n}, testCommandOptions), function (options) {\n  options['test'] = true;\n  return doTestCommand(options);\n});\n\nmain.registerCommand(_.extend(\n  { name: 'test-packages' },\n  testCommandOptions\n), function (options) {\n  options['test-packages'] = true;\n  return doTestCommand(options);\n});\n\nfunction doTestCommand(options) {\n  // This \"metadata\" is accessed in a few places. Using a global\n  // variable here was more expedient than navigating the many layers\n  // of abstraction across the the build process.\n  //\n  // As long as the Meteor CLI runs a single command as part of each\n  // process, this should be safe.\n  global.testCommandMetadata = {};\n\n  Console.setVerbose(!!options.verbose);\n  if (options.headless) {\n    Console.setHeadless(true);\n  }\n\n  const runTargets = parseRunTargets(_.intersection(\n    Object.keys(options), ['ios', 'ios-device', 'android', 'android-device']));\n\n  const { parsedServerUrl, parsedMobileServerUrl, parsedCordovaServerPort } =\n    parseServerOptionsForRunCommand(options, runTargets);\n\n  // Make a temporary app dir (based on the test runner app). This will be\n  // cleaned up on process exit. Using a temporary app dir means that we can\n  // run multiple \"test-packages\" commands in parallel without them stomping\n  // on each other.\n  let testRunnerAppDir;\n  const testAppPath = options['test-app-path'];\n  if (testAppPath) {\n    const absTestAppPath = files.pathResolve(testAppPath);\n    try {\n      if (files.mkdir_p(absTestAppPath, 0o700)) {\n        testRunnerAppDir = absTestAppPath;\n      } else {\n        Console.error(\n          'The specified --test-app-path directory could not be used, as ' +\n          `\"${testAppPath}\" already exists and it is not a directory.`\n        );\n        return 1;\n      }\n    } catch (error) {\n      Console.error(\n        'Unable to create the specified --test-app-path directory of ' +\n        `\"${testAppPath}\".`\n      );\n      throw error;\n    }\n  }\n\n  if (!testRunnerAppDir) {\n    testRunnerAppDir = files.mkdtemp('meteor-test-run');\n  }\n\n  // Download packages for our architecture, and for the deploy server's\n  // architecture if we're deploying.\n  var serverArchitectures = [archinfo.host()];\n  if (options.deploy && DEPLOY_ARCH !== archinfo.host()) {\n    serverArchitectures.push(DEPLOY_ARCH);\n  }\n\n  if (options['raw-logs']) {\n    runLog.setRawLogs(true);\n  }\n\n  var includePackages = [];\n  if (options['extra-packages']) {\n    includePackages = options['extra-packages'].trim().split(/\\s*,\\s*/);\n  }\n\n  if (options['driver-package']) {\n    includePackages.push(\n      global.testCommandMetadata.driverPackage =\n        options['driver-package'].trim()\n    );\n  } else if (options[\"test-packages\"]) {\n    includePackages.push(\n      global.testCommandMetadata.driverPackage = \"test-in-browser\"\n    );\n  }\n\n  var projectContextOptions = {\n    serverArchitectures: serverArchitectures,\n    allowIncompatibleUpdate: options['allow-incompatible-update'],\n    lintAppAndLocalPackages: !options['no-lint'],\n    includePackages: includePackages\n  };\n  var projectContext;\n\n  if (options[\"test-packages\"]) {\n    projectContextOptions.projectDir = testRunnerAppDir;\n    projectContextOptions.projectDirForLocalPackages = options.appDir;\n\n    try {\n      require(\"./default-npm-deps.js\").install(testRunnerAppDir);\n    } catch (error) {\n      if (error.code === 'EACCES' && options['test-app-path']) {\n        Console.error(\n          'The specified --test-app-path directory of ' +\n          `\"${testRunnerAppDir}\" exists, but the current user does not have ` +\n          `read/write permission in it.`\n        );\n      }\n      throw error;\n    }\n\n    if (buildmessage.jobHasMessages()) {\n      return;\n    }\n\n    // Find any packages mentioned by a path instead of a package name. We will\n    // load them explicitly into the catalog.\n    var packagesByPath = _.filter(options.args, function (p) {\n      return p.indexOf('/') !== -1;\n    });\n    // If we're currently in an app, we still want to use the real app's\n    // packages subdirectory, not the test runner app's empty one.\n    projectContextOptions.explicitlyAddedLocalPackageDirs = packagesByPath;\n\n    // XXX Because every run uses a new app with its own IsopackCache directory,\n    //     this always does a clean build of all packages. Maybe we can speed up\n    //     repeated test-packages calls with some sort of shared or semi-shared\n    //     isopack cache that's specific to test-packages?  See #3012.\n    projectContext = new projectContextModule.ProjectContext(projectContextOptions);\n\n    main.captureAndExit(\"=> Errors while initializing project:\", function () {\n      // We're just reading metadata here --- we'll wait to do the full build\n      // preparation until after we've started listening on the proxy, etc.\n      projectContext.readProjectMetadata();\n    });\n\n    main.captureAndExit(\"=> Errors while setting up tests:\", function () {\n      // Read metadata and initialize catalog.\n      projectContext.initializeCatalog();\n    });\n\n    // Overwrite .meteor/release.\n    projectContext.releaseFile.write(\n      release.current.isCheckout() ? \"none\" : release.current.name);\n\n    var packagesToAdd = getTestPackageNames(projectContext, options.args);\n\n    // filter out excluded packages\n    var excludedPackages = options.exclude && options.exclude.split(',');\n    if (excludedPackages) {\n      packagesToAdd = _.filter(packagesToAdd, function (p) {\n        return ! _.some(excludedPackages, function (excluded) {\n          return p.replace(/^local-test:/, '') === excluded;\n        });\n      });\n    }\n\n    // Use the driver package if running `meteor test-packages`. For\n    // `meteor test`, the driver package is expected to already\n    // have been added to the app.\n    packagesToAdd.unshift(global.testCommandMetadata.driverPackage);\n\n    // Also, add `autoupdate` so that you don't have to manually refresh the tests\n    packagesToAdd.unshift(\"autoupdate\");\n\n    var constraintsToAdd = _.map(packagesToAdd, function (p) {\n      return utils.parsePackageConstraint(p);\n    });\n    // Add the packages to our in-memory representation of .meteor/packages.  (We\n    // haven't yet resolved constraints, so this will affect constraint\n    // resolution.)  This will get written to disk once we prepareProjectForBuild,\n    // either in the Cordova code below, right before deploying below, or in the\n    // app runner.  (Note that removeAllPackages removes any comments from\n    // .meteor/packages, but that's OK since this isn't a real user project.)\n    projectContext.projectConstraintsFile.removeAllPackages();\n    projectContext.projectConstraintsFile.addConstraints(constraintsToAdd);\n    // Write these changes to disk now, so that if the first attempt to prepare\n    // the project for build hits errors, we don't lose them on\n    // projectContext.reset.\n    projectContext.projectConstraintsFile.writeIfModified();\n  } else if (options[\"test\"]) {\n    if (!options['driver-package']) {\n      throw new Error(\"You must specify a driver package with --driver-package\");\n    }\n\n    global.testCommandMetadata.driverPackage = options['driver-package'];\n\n    global.testCommandMetadata.isAppTest = options['full-app'];\n    global.testCommandMetadata.isTest = !global.testCommandMetadata.isAppTest;\n\n    projectContextOptions.projectDir = options.appDir;\n    projectContextOptions.projectLocalDir = files.pathJoin(testRunnerAppDir, '.meteor', 'local');\n\n    // Copy the existing build and isopacks to speed up the initial start\n    function copyDirIntoTestRunnerApp(allowSymlink, ...parts) {\n      // Depending on whether the user has run `meteor run` or other commands, they\n      // may or may not exist yet\n      const appDirPath = files.pathJoin(options.appDir, ...parts);\n      const testDirPath = files.pathJoin(testRunnerAppDir, ...parts);\n\n      files.mkdir_p(appDirPath);\n      files.mkdir_p(files.pathDirname(testDirPath));\n\n      if (allowSymlink) {\n        // Windows can create junction links without administrator\n        // privileges since both paths refer to directories.\n        files.symlink(appDirPath, testDirPath, \"junction\");\n      } else {\n        files.cp_r(appDirPath, testDirPath, {\n          preserveSymlinks: true\n        });\n      }\n    }\n\n    copyDirIntoTestRunnerApp(false, '.meteor', 'local', 'build');\n    copyDirIntoTestRunnerApp(true, '.meteor', 'local', 'bundler-cache');\n    copyDirIntoTestRunnerApp(true, '.meteor', 'local', 'isopacks');\n    copyDirIntoTestRunnerApp(true, '.meteor', 'local', 'plugin-cache');\n    copyDirIntoTestRunnerApp(true, '.meteor', 'local', 'shell');\n\n    projectContext = new projectContextModule.ProjectContext(projectContextOptions);\n\n    main.captureAndExit(\"=> Errors while setting up tests:\", function () {\n      // Read metadata and initialize catalog.\n      projectContext.initializeCatalog();\n    });\n  } else {\n    throw new Error(\"Unexpected: neither test-packages nor test\");\n  }\n\n  // The rest of the projectContext preparation process will happen inside the\n  // runner, once the proxy is listening. The changes we made were persisted to\n  // disk, so projectContext.reset won't make us forget anything.\n\n  let cordovaRunner;\n\n  if (!_.isEmpty(runTargets)) {\n    function prepareCordovaProject() {\n      main.captureAndExit('', 'preparing Cordova project', () => {\n        import { CordovaProject } from '../cordova/project.js';\n\n        const cordovaProject = new CordovaProject(projectContext, {\n          settingsFile: options.settings,\n          mobileServerUrl: utils.formatUrl(parsedMobileServerUrl),\n          cordovaServerPort: parsedCordovaServerPort });\n        if (buildmessage.jobHasMessages()) return;\n\n        cordovaRunner = new CordovaRunner(cordovaProject, runTargets);\n        projectContext.platformList.write(cordovaRunner.platformsForRunTargets);\n        cordovaRunner.checkPlatformsForRunTargets();\n      });\n    }\n\n    ensureDevBundleDependencies();\n    prepareCordovaProject();\n  }\n\n  options.cordovaRunner = cordovaRunner;\n\n  return runTestAppForPackages(projectContext, _.extend(\n    options,\n    {\n      mobileServerUrl: utils.formatUrl(parsedMobileServerUrl),\n      cordovaServerPort: parsedCordovaServerPort,\n      proxyPort: parsedServerUrl.port,\n      proxyHost: parsedServerUrl.hostname,\n    }\n  ));\n}\n\n// Returns the \"local-test:*\" package names for the given package names (or for\n// all local packages if packageNames is empty/unspecified).\nvar getTestPackageNames = function (projectContext, packageNames) {\n  var packageNamesSpecifiedExplicitly = ! _.isEmpty(packageNames);\n  if (_.isEmpty(packageNames)) {\n    // If none specified, test all local packages. (We don't have tests for\n    // non-local packages.)\n    packageNames = projectContext.localCatalog.getAllPackageNames();\n  }\n  var testPackages = [];\n  main.captureAndExit(\"=> Errors while collecting tests:\", function () {\n    _.each(packageNames, function (p) {\n      buildmessage.enterJob(\"trying to test package `\" + p + \"`\", function () {\n        // If it's a package name, look it up the normal way.\n        if (p.indexOf('/') === -1) {\n          if (p.indexOf('@') !== -1) {\n            buildmessage.error(\n              \"You may not specify versions for local packages: \" + p );\n            return;  // recover by ignoring\n          }\n          // Check to see if this is a real local package, and if it is a real\n          // local package, if it has tests.\n          var version = projectContext.localCatalog.getLatestVersion(p);\n          if (! version) {\n            buildmessage.error(\"Not a known local package, cannot test\");\n          } else if (version.testName) {\n            testPackages.push(version.testName);\n          } else if (packageNamesSpecifiedExplicitly) {\n            // It's only an error to *ask* to test a package with no tests, not\n            // to come across a package with no tests when you say \"test all\n            // packages\".\n            buildmessage.error(\"Package has no tests\");\n          }\n        } else {\n          // Otherwise, it's a directory; find it by source root.\n          version = projectContext.localCatalog.getVersionBySourceRoot(\n            files.pathResolve(p));\n          if (! version) {\n            buildmessage.error(\"Package not found in local catalog\");\n            return;\n          }\n          if (version.testName) {\n            testPackages.push(version.testName);\n          }\n          // It is not an error to mention a package by directory that is a\n          // package but has no tests; this means you can run `meteor\n          // test-packages $APP/packages/*` without having to worry about the\n          // packages that don't have tests.\n        }\n      });\n    });\n  });\n\n  return testPackages;\n};\n\nvar runTestAppForPackages = function (projectContext, options) {\n  var buildOptions = {\n    minifyMode: options.production ? 'production' : 'development'\n  };\n  buildOptions.buildMode = \"test\";\n  let webArchs = projectContext.platformList.getWebArchs();\n  if (options.cordovaRunner) {\n    webArchs.push(\"web.cordova\");\n  }\n  buildOptions.webArchs = filterWebArchs(webArchs, options['exclude-archs']);\n\n  if (options.deploy) {\n    // Run the constraint solver and build local packages.\n    main.captureAndExit(\"=> Errors while initializing project:\", function () {\n      projectContext.prepareProjectForBuild();\n    });\n    // No need to display the PackageMapDelta here, since it would include all\n    // of the packages!\n\n    buildOptions.serverArch = DEPLOY_ARCH;\n    return deploy.bundleAndDeploy({\n      projectContext: projectContext,\n      site: options.deploy,\n      settingsFile: options.settings,\n      buildOptions: buildOptions,\n      recordPackageUsage: false\n    });\n  } else {\n    var runAll = require('../runners/run-all.js');\n    return runAll.run({\n      projectContext: projectContext,\n      proxyPort: options.proxyPort,\n      proxyHost: options.proxyHost,\n      ...normalizeInspectOptions(options),\n      disableOplog: options['disable-oplog'],\n      settingsFile: options.settings,\n      testMetadata: global.testCommandMetadata,\n      banner: options['show-test-app-path'] ? null : \"Tests\",\n      buildOptions: buildOptions,\n      rootUrl: process.env.ROOT_URL,\n      mongoUrl: process.env.MONGO_URL,\n      oplogUrl: process.env.MONGO_OPLOG_URL,\n      mobileServerUrl: options.mobileServerUrl,\n      once: options.once,\n      noReleaseCheck: options['no-release-check'] || process.env.METEOR_NO_RELEASE_CHECK,\n      recordPackageUsage: false,\n      selenium: options.selenium,\n      seleniumBrowser: options['selenium-browser'],\n      cordovaRunner: options.cordovaRunner,\n      // On the first run, we shouldn't display the delta between \"no packages\n      // in the temp app\" and \"all the packages we're testing\". If we make\n      // changes and reload, though, it's fine to display them.\n      omitPackageMapDeltaDisplayOnFirstRun: true\n    });\n  }\n};\n\n\n\n///////////////////////////////////////////////////////////////////////////////\n// rebuild\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'rebuild',\n  maxArgs: Infinity,\n  hidden: true,\n  requiresApp: true,\n  catalogRefresh: new catalog.Refresh.Never(),\n  'allow-incompatible-update': { type: Boolean }\n}, function (options) {\n  var projectContextModule = require('../project-context.js');\n  var projectContext = new projectContextModule.ProjectContext({\n    projectDir: options.appDir,\n    forceRebuildPackages: options.args.length ? options.args : true,\n    allowIncompatibleUpdate: options['allow-incompatible-update']\n  });\n\n  main.captureAndExit(\"=> Errors while rebuilding packages:\", function () {\n    projectContext.prepareProjectForBuild();\n  });\n  projectContext.packageMapDelta.displayOnConsole();\n\n  Console.info(\"Packages rebuilt.\");\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// login\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'login',\n  options: {\n    email: { type: Boolean }\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  return auth.loginCommand(_.extend({\n    overwriteExistingToken: true\n  }, options));\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// logout\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'logout',\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  return auth.logoutCommand(options);\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// whoami\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'whoami',\n  catalogRefresh: new catalog.Refresh.Never(),\n  pretty: false\n}, function (options) {\n  return auth.whoAmICommand(options);\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// organizations\n///////////////////////////////////////////////////////////////////////////////\n\nvar loggedInAccountsConnectionOrPrompt = function (action) {\n  var token = auth.getSessionToken(config.getAccountsDomain());\n  if (! token) {\n    Console.error(\"You must be logged in to \" + action + \".\");\n    auth.doUsernamePasswordLogin({ retry: true });\n    Console.info();\n  }\n\n  token = auth.getSessionToken(config.getAccountsDomain());\n  var conn = auth.loggedInAccountsConnection(token);\n  if (conn === null) {\n    // Server rejected our token.\n    Console.error(\"You must be logged in to \" + action + \".\");\n    auth.doUsernamePasswordLogin({ retry: true });\n    Console.info();\n    token = auth.getSessionToken(config.getAccountsDomain());\n    conn = auth.loggedInAccountsConnection(token);\n  }\n\n  return conn;\n};\n\n// List the organizations of which the current user is a member.\nmain.registerCommand({\n  name: 'admin list-organizations',\n  minArgs: 0,\n  maxArgs: 0,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n\n  var token = auth.getSessionToken(config.getAccountsDomain());\n  if (! token) {\n    Console.error(\"You must be logged in to list your organizations.\");\n    auth.doUsernamePasswordLogin({ retry: true });\n    Console.info();\n  }\n\n  var url = config.getAccountsApiUrl() + \"/organizations\";\n  try {\n    var result = httpHelpers.request({\n      url: url,\n      method: \"GET\",\n      useSessionHeader: true,\n      useAuthHeader: true\n    });\n    var body = JSON.parse(result.body);\n  } catch (err) {\n    Console.error(\"Error listing organizations.\");\n    return 1;\n  }\n\n  if (result.response.statusCode === 401 &&\n      body && body.error === \"invalid_credential\") {\n    Console.error(\"You must be logged in to list your organizations.\");\n    // XXX It would be nice to do a username/password prompt here like\n    // we do for the other orgs commands.\n    return 1;\n  }\n\n  if (result.response.statusCode !== 200 ||\n      ! body || ! body.organizations) {\n    Console.error(\"Error listing organizations.\");\n    return 1;\n  }\n\n  if (body.organizations.length === 0) {\n    Console.info(\"You are not a member of any organizations.\");\n  } else {\n    Console.rawInfo(_.pluck(body.organizations, \"name\").join(\"\\n\") + \"\\n\");\n  }\n  return 0;\n});\n\nmain.registerCommand({\n  name: 'admin members',\n  minArgs: 1,\n  maxArgs: 1,\n  options: {\n    add: { type: String },\n    remove: { type: String },\n    list: { type: Boolean }\n  },\n  pretty: function (options) {\n    // pretty if we're mutating; plain if we're listing (which is more likely to\n    // be used by scripts)\n    return options.add || options.remove;\n  },\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n\n  if (options.add && options.remove) {\n    Console.error(\n      \"Sorry, you can only add or remove one member at a time.\");\n    throw new main.ShowUsage;\n  }\n\n  var username = options.add || options.remove;\n\n  var conn = loggedInAccountsConnectionOrPrompt(\n    username ? \"edit organizations\" : \"show an organization's members\");\n\n  if (username ) {\n    // Adding or removing members\n    try {\n      conn.call(\n        options.add ? \"addOrganizationMember\": \"removeOrganizationMember\",\n        options.args[0], username);\n    } catch (err) {\n      Console.error(\"Error \" +\n                    (options.add ? \"adding\" : \"removing\") +\n                    \" member: \" + err.reason);\n      return 1;\n    }\n\n    Console.info(username + \" \" +\n                         (options.add ? \"added to\" : \"removed from\") +\n                         \" organization \" + options.args[0] + \".\");\n  } else {\n    // Showing the members of an org\n    try {\n      var result = conn.call(\"showOrganization\", options.args[0]);\n    } catch (err) {\n      Console.error(\"Error showing organization: \" + err.reason);\n      return 1;\n    }\n\n    var members = _.pluck(result, \"username\");\n    Console.rawInfo(members.join(\"\\n\") + \"\\n\");\n  }\n\n  return 0;\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// self-test\n///////////////////////////////////////////////////////////////////////////////\n\n// XXX we should find a way to make self-test fully self-contained, so that it\n// ignores \"packageDirs\" (ie, it shouldn't fail just because you happen to be\n// sitting in an app with packages that don't build)\n\nmain.registerCommand({\n  name: 'self-test',\n  minArgs: 0,\n  maxArgs: 1,\n  options: {\n    changed: { type: Boolean },\n    'force-online': { type: Boolean },\n    slow: { type: Boolean },\n    galaxy: { type: Boolean },\n    browserstack: { type: Boolean },\n    phantom: { type: Boolean },\n    // Indicates whether these self-tests are running headless, e.g. in a\n    // continuous integration testing environment, where visual niceties\n    // like progress bars and spinners are unimportant.\n    headless: { type: Boolean },\n    history: { type: Number },\n    list: { type: Boolean },\n    file: { type: String },\n    exclude: { type: String },\n    // Skip tests w/ this tag\n    'without-tag': { type: String },\n    // Only run tests with this tag\n    'with-tag': { type: String },\n    junit: { type: String },\n    retries: { type: Number, default: 2 },\n  },\n  hidden: true,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  if (! files.inCheckout()) {\n    Console.error(\"self-test is only supported running from a checkout\");\n    return 1;\n  }\n\n  var selftest = require('../tool-testing/selftest.js');\n\n  // Auto-detect whether to skip 'net' tests, unless --force-online is passed.\n  var offline = false;\n  if (!options['force-online']) {\n    try {\n      require('../utils/http-helpers.js').getUrl(\"http://www.google.com/\");\n    } catch (e) {\n      if (e instanceof files.OfflineError) {\n        offline = true;\n      }\n    }\n  }\n\n  var compileRegexp = function (str) {\n    try {\n      return new RegExp(str);\n    } catch (e) {\n      if (!(e instanceof SyntaxError)) {\n        throw e;\n      }\n      Console.error(\"Bad regular expression: \" + str);\n      return null;\n    }\n  };\n\n  var testRegexp = undefined;\n  if (options.args.length) {\n    testRegexp = compileRegexp(options.args[0]);\n    if (! testRegexp) {\n      return 1;\n    }\n  }\n\n  var fileRegexp = undefined;\n  if (options.file) {\n    fileRegexp = compileRegexp(options.file);\n    if (! fileRegexp) {\n      return 1;\n    }\n  }\n\n  var excludeRegexp = undefined;\n  if (options.exclude) {\n    excludeRegexp = compileRegexp(options.exclude);\n    if (! excludeRegexp) {\n      return 1;\n    }\n  }\n\n  if (options.list) {\n    selftest.listTests({\n      onlyChanged: options.changed,\n      offline: offline,\n      includeSlowTests: options.slow,\n      galaxyOnly: options.galaxy,\n      testRegexp: testRegexp,\n      fileRegexp: fileRegexp,\n      'without-tag': options['without-tag'],\n      'with-tag': options['with-tag']\n    });\n\n    return 0;\n  }\n\n  const clients = {\n    puppeteer: true, // Puppeteer is always enabled.\n    phantom: options.phantom,\n    browserstack: options.browserstack,\n  };\n\n  if (options.headless) {\n    // There's no point in spinning the spinner when we're running\n    // continuous integration tests.\n    Console.setHeadless(true);\n  }\n\n  return selftest.runTests({\n    // filtering options\n    onlyChanged: options.changed,\n    offline: offline,\n    includeSlowTests: options.slow,\n    galaxyOnly: options.galaxy,\n    testRegexp: testRegexp,\n    fileRegexp: fileRegexp,\n    excludeRegexp: excludeRegexp,\n    // other options\n    retries: options.retries,\n    historyLines: options.history,\n    clients: clients,\n    junit: options.junit && files.pathResolve(options.junit),\n    'without-tag': options['without-tag'],\n    'with-tag': options['with-tag']\n  });\n\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// list-sites\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'list-sites',\n  minArgs: 0,\n  maxArgs: 0,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  auth.pollForRegistrationCompletion();\n  if (! auth.isLoggedIn()) {\n    Console.error(\n      \"You must be logged in for that. Try \" +\n      Console.command(\"'meteor login'\") + \".\");\n    return 1;\n  }\n\n  return deploy.listSites();\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// admin get-machine\n///////////////////////////////////////////////////////////////////////////////\n\nmain.registerCommand({\n  name: 'admin get-machine',\n  minArgs: 1,\n  maxArgs: 1,\n  options: {\n    json: { type: Boolean },\n    verbose: { type: Boolean, short: \"v\" },\n    // By default, we give you a machine for 5 minutes. You can request up to\n    // 15. (Meteor Software can reserve machines for longer than that.)\n    minutes: { type: Number }\n  },\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  Console.warn();\n  Console.warn(\"The 'meteor admin get-machine' command has been disabled and\",\n    \"the build farm has been discontinued.\");\n  Console.warn();\n  Console.info(\"As of Meteor 1.4, packages with binary dependencies are\",\n    \"automatically compiled when they are installed in an application,\",\n    \"assuming the target machine has a basic compiler toolchain.\");\n  Console.info();\n  Console.info(\"To see the requirements for this compilation step,\",\n    \"consult the platform requirements for 'node-gyp':\");\n  Console.info(\n    Console.url(\"https://github.com/nodejs/node-gyp\"),\n    Console.options({ indent: 2 })\n  );\n  Console.info();\n  return 1;\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// admin progressbar-test\n///////////////////////////////////////////////////////////////////////////////\n\n// A test command to print a progressbar. Useful for manual testing.\nmain.registerCommand({\n  name: 'admin progressbar-test',\n  options: {\n    secs: { type: Number, default: 20 },\n    spinner: { type: Boolean, default: false }\n  },\n  hidden: true,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  buildmessage.enterJob({ title: \"A test progressbar\" }, function () {\n    var progress = buildmessage.getCurrentProgressTracker();\n    var totalProgress = { current: 0, end: options.secs, done: false };\n    var i = 0;\n    var n = options.secs;\n\n    if (options.spinner) {\n      totalProgress.end = undefined;\n    }\n\n    new Promise(function (resolve) {\n      function updateProgress() {\n        i++;\n        if (! options.spinner) {\n          totalProgress.current = i;\n        }\n\n        if (i === n) {\n          totalProgress.done = true;\n          progress.reportProgress(totalProgress);\n          resolve();\n        } else {\n          progress.reportProgress(totalProgress);\n          setTimeout(updateProgress, 1000);\n        }\n      }\n\n      setTimeout(updateProgress);\n    }).await();\n  });\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// dummy\n///////////////////////////////////////////////////////////////////////////////\n\n// Dummy test command. Used for automated testing of the command line\n// option parser.\n\nmain.registerCommand({\n  name: 'dummy',\n  options: {\n    ething: { type: String, short: \"e\", required: true },\n    port: { type: Number, short: \"p\", default: DEFAULT_PORT },\n    url: { type: Boolean, short: \"U\" },\n    'delete': { type: Boolean, short: \"D\" },\n    changed: { type: Boolean }\n  },\n  maxArgs: 2,\n  hidden: true,\n  pretty: false,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function (options) {\n  var p = function (key) {\n    if (_.has(options, key)) {\n      return JSON.stringify(options[key]);\n    }\n    return 'none';\n  };\n\n  Console.info(p('ething') + \" \" + p('port') + \" \" + p('changed') +\n                       \" \" + p('args'));\n  if (options.url) {\n    Console.info('url');\n  }\n  if (options['delete']) {\n    Console.info('delete');\n  }\n});\n\n///////////////////////////////////////////////////////////////////////////////\n// throw-error\n///////////////////////////////////////////////////////////////////////////////\n\n// Dummy test command. Used to test that stack traces work from an installed\n// Meteor tool.\n\nmain.registerCommand({\n  name: 'throw-error',\n  hidden: true,\n  catalogRefresh: new catalog.Refresh.Never()\n}, function () {\n  throw new Error(\"testing stack traces!\"); // #StackTraceTest this line is found in tests/source-maps.js\n});\n"],"file":"tools/cli/commands.js.map"}