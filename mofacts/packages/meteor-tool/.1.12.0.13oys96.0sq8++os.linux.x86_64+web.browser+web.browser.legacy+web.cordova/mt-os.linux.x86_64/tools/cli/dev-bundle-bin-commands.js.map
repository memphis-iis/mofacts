{"version":3,"sources":["/tools/cli/dev-bundle-bin-commands.js"],"names":["fs","require","path","devBundleBinCommand","process","argv","args","slice","getChildProcess","Promise","resolve","helpers","all","getDevBundle","getEnv","then","devBundleAndEnv","devBundleDir","cmd","getCommand","env","child","spawn","stdio","on","error","console","log","stack","exitCode","exit","module","exports"],"mappings":";AAAA;AACA;AAEA,MAAIA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAhB;;AACA,MAAIC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAAlB,C,CAEA;AACA;AACA;;;AACA,MAAIE,mBAAmB,GAAGC,OAAO,CAACC,IAAR,CAAa,CAAb,CAA1B;AACA,MAAIC,IAAI,GAAGF,OAAO,CAACC,IAAR,CAAaE,KAAb,CAAmB,CAAnB,CAAX;;AAEA,WAASC,eAAT,GAA2B;AACzB,QAAI,OAAOL,mBAAP,KAA+B,QAAnC,EAA6C;AAC3C,aAAOM,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP;AACD;;AAED,QAAIC,OAAO,GAAGV,OAAO,CAAC,6BAAD,CAArB;;AAEA,WAAOQ,OAAO,CAACG,GAAR,CAAY,CACjBD,OAAO,CAACE,YAAR,EADiB,EAEjBF,OAAO,CAACG,MAAR,EAFiB,CAAZ,EAGJC,IAHI,CAGC,UAAUC,eAAV,EAA2B;AACjC,UAAIC,YAAY,GAAGD,eAAe,CAAC,CAAD,CAAlC;AACA,UAAIE,GAAG,GAAGP,OAAO,CAACQ,UAAR,CAAmBhB,mBAAnB,EAAwCc,YAAxC,CAAV;;AACA,UAAI,CAAEC,GAAN,EAAW;AACT,eAAO,IAAP;AACD;;AAED,UAAIE,GAAG,GAAGJ,eAAe,CAAC,CAAD,CAAzB;;AACA,UAAIK,KAAK,GAAGpB,OAAO,CAAC,eAAD,CAAP,CAAyBqB,KAAzB,CAA+BJ,GAA/B,EAAoCZ,IAApC,EAA0C;AACpDiB,QAAAA,KAAK,EAAE,SAD6C;AAEpDH,QAAAA,GAAG,EAAEA;AAF+C,OAA1C,CAAZ;;AAKAnB,MAAAA,OAAO,CAAC,uCAAD,CAAP;;AAEAoB,MAAAA,KAAK,CAACG,EAAN,CAAS,OAAT,EAAkB,UAAUC,KAAV,EAAiB;AACjCC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,KAAN,IAAeH,KAA3B;AACD,OAFD;AAIAJ,MAAAA,KAAK,CAACG,EAAN,CAAS,MAAT,EAAiB,UAAUK,QAAV,EAAoB;AACnCzB,QAAAA,OAAO,CAAC0B,IAAR,CAAaD,QAAb;AACD,OAFD;AAIA,aAAOR,KAAP;AACD,KA3BM,CAAP;AA4BD;;AAEDU,EAAAA,MAAM,CAACC,OAAP,GAAiBxB,eAAe,EAAhC","sourcesContent":["// Note that this file is required before we install our Babel hooks in\n// ../tool-env/install-babel.js, so we can't use ES2015+ syntax here.\n\nvar fs = require(\"fs\");\nvar path = require(\"path\");\n\n// The dev_bundle/bin command has to come immediately after the meteor\n// command, as in `meteor npm` or `meteor node`, because we don't want to\n// require(\"./main.js\") for these commands.\nvar devBundleBinCommand = process.argv[2];\nvar args = process.argv.slice(3);\n\nfunction getChildProcess() {\n  if (typeof devBundleBinCommand !== \"string\") {\n    return Promise.resolve(null);\n  }\n\n  var helpers = require(\"./dev-bundle-bin-helpers.js\");\n\n  return Promise.all([\n    helpers.getDevBundle(),\n    helpers.getEnv()\n  ]).then(function (devBundleAndEnv) {\n    var devBundleDir = devBundleAndEnv[0];\n    var cmd = helpers.getCommand(devBundleBinCommand, devBundleDir);\n    if (! cmd) {\n      return null;\n    }\n\n    var env = devBundleAndEnv[1];\n    var child = require(\"child_process\").spawn(cmd, args, {\n      stdio: \"inherit\",\n      env: env\n    });\n\n    require(\"./flush-buffers-on-exit-in-windows.js\");\n\n    child.on(\"error\", function (error) {\n      console.log(error.stack || error);\n    });\n\n    child.on(\"exit\", function (exitCode) {\n      process.exit(exitCode);\n    });\n\n    return child;\n  });\n}\n\nmodule.exports = getChildProcess();\n"],"file":"tools/cli/dev-bundle-bin-commands.js.map"}