{"version":3,"sources":["/tools/tool-testing/clients/puppeteer/index.js"],"names":["module","export","default","PuppeteerClient","Client","link","v","enterJob","ensureDependencies","NPM_DEPENDENCIES","puppeteer","constructor","options","title","npmPackageExports","require","name","connect","browser","launch","args","page","newPage","goto","host","port","stop","close","pushClients","clients","appConfig","push"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,OAAO,EAAC,MAAIC;AAAb,CAAd;AAA6C,IAAIC,MAAJ;AAAWJ,MAAM,CAACK,IAAP,CAAY,iBAAZ,EAA8B;AAACH,EAAAA,OAAO,CAACI,CAAD,EAAG;AAACF,IAAAA,MAAM,GAACE,CAAP;AAAS;;AAArB,CAA9B,EAAqD,CAArD;AAAwD,IAAIC,QAAJ;AAAaP,MAAM,CAACK,IAAP,CAAY,gCAAZ,EAA6C;AAACE,EAAAA,QAAQ,CAACD,CAAD,EAAG;AAACC,IAAAA,QAAQ,GAACD,CAAT;AAAW;;AAAxB,CAA7C,EAAuE,CAAvE;AAA0E,IAAIE,kBAAJ;AAAuBR,MAAM,CAACK,IAAP,CAAY,oCAAZ,EAAiD;AAACG,EAAAA,kBAAkB,CAACF,CAAD,EAAG;AAACE,IAAAA,kBAAkB,GAACF,CAAnB;AAAqB;;AAA5C,CAAjD,EAA+F,CAA/F;AAI9N,MAAMG,gBAAgB,GAAG;AACvBC,EAAAA,SAAS,EAAE;AADY,CAAzB;;AAIe,MAAMP,eAAN,SAA8BC,MAA9B,CAAqC;AAClDO,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAMA,OAAN;AAEAL,IAAAA,QAAQ,CACN;AACEM,MAAAA,KAAK,EAAE;AADT,KADM,EAIN,MAAM;AACJL,MAAAA,kBAAkB,CAACC,gBAAD,CAAlB;AACD,KANK,CAAR;AASA,SAAKK,iBAAL,GAAyBC,OAAO,CAAC,WAAD,CAAhC;AAEA,SAAKC,IAAL,GAAY,WAAZ;AACD;;AAEKC,EAAAA,OAAO;AAAA,oCAAG;AACd;AACA;AACA;AACA,WAAKC,OAAL,iBAAqB,KAAKJ,iBAAL,CAAuBK,MAAvB,CAA8B;AAAEC,QAAAA,IAAI,EAAE,CAAC,cAAD,EAAiB,0BAAjB;AAAR,OAA9B,CAArB;AACA,WAAKC,IAAL,iBAAkB,KAAKH,OAAL,CAAaI,OAAb,EAAlB;AACA,WAAKD,IAAL,CAAUE,IAAV,kBAAyB,KAAKC,IAA9B,cAAsC,KAAKC,IAA3C;AACD,KAPY;AAAA;;AASPC,EAAAA,IAAI;AAAA,oCAAG;AACX,WAAKL,IAAL,kBAAmB,KAAKA,IAAL,CAAUM,KAAV,EAAnB;AACA,WAAKN,IAAL,GAAY,IAAZ;AAEA,WAAKH,OAAL,kBAAsB,KAAKA,OAAL,CAAaS,KAAb,EAAtB;AACA,WAAKT,OAAL,GAAe,IAAf;AACD,KANS;AAAA;;AAQQ,SAAXU,WAAW,CAACC,OAAD,EAAUC,SAAV,EAAqB;AACrCD,IAAAA,OAAO,CAACE,IAAR,CAAa,IAAI5B,eAAJ,CAAoB2B,SAApB,CAAb;AACD;;AArCiD","sourcesContent":["import Client from '../../client.js';\nimport { enterJob } from '../../../utils/buildmessage.js';\nimport { ensureDependencies } from '../../../cli/dev-bundle-helpers.js';\n\nconst NPM_DEPENDENCIES = {\n  puppeteer: '8.0.0'\n};\n\nexport default class PuppeteerClient extends Client {\n  constructor(options) {\n    super(options);\n\n    enterJob(\n      {\n        title: 'Installing Puppeteer in Meteor tool'\n      },\n      () => {\n        ensureDependencies(NPM_DEPENDENCIES);\n      }\n    );\n\n    this.npmPackageExports = require('puppeteer');\n\n    this.name = 'Puppeteer';\n  }\n\n  async connect() {\n    // Note for Travis and CircleCI to run sandbox must be turned off.\n    // From a security perspective this is not ideal, in the future would be worthwhile\n    // to configure to include only for CI based setups\n    this.browser = await this.npmPackageExports.launch({ args: ['--no-sandbox', '--disable-setuid-sandbox'] });\n    this.page = await this.browser.newPage();\n    this.page.goto(`http://${this.host}:${this.port}`);\n  }\n\n  async stop() {\n    this.page && await this.page.close();\n    this.page = null;\n\n    this.browser && await this.browser.close();\n    this.browser = null;\n  }\n\n  static pushClients(clients, appConfig) {\n    clients.push(new PuppeteerClient(appConfig));\n  }\n}\n"],"file":"tools/tool-testing/clients/puppeteer/index.js.map"}