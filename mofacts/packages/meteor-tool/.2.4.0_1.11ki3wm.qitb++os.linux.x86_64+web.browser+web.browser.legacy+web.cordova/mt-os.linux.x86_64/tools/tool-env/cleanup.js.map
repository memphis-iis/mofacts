{"version":3,"sources":["/tools/tool-env/cleanup.js"],"names":["module","export","onExit","noYieldsAllowed","link","v","exitHandlers","func","push","runHandlers","splice","forEach","f","process","on","sig","once","kill","pid"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,MAAM,EAAC,MAAIA;AAAZ,CAAd;AAAmC,IAAIC,eAAJ;AAAoBH,MAAM,CAACI,IAAP,CAAY,2BAAZ,EAAwC;AAACD,EAAAA,eAAe,CAACE,CAAD,EAAG;AAACF,IAAAA,eAAe,GAACE,CAAhB;AAAkB;;AAAtC,CAAxC,EAAgF,CAAhF;AAIvD,MAAMC,YAAY,GAAG,EAArB;;AAEO,SAASJ,MAAT,CAAgBK,IAAhB,EAAsB;AAC3BD,EAAAA,YAAY,CAACE,IAAb,CAAkBD,IAAlB;AACD;;AAED,SAASE,WAAT,GAAuB;AACrBN,EAAAA,eAAe,CAAC,MAAM;AACpB;AACAG,IAAAA,YAAY,CAACI,MAAb,CAAoB,CAApB,EAAuBC,OAAvB,CAAgCC,CAAD,IAAO;AACpCA,MAAAA,CAAC;AACF,KAFD;AAGD,GALc,CAAf;AAMD;;AAEDC,OAAO,CAACC,EAAR,CAAW,MAAX,EAAmBL,WAAnB;AACA,CAAC,QAAD,EAAW,QAAX,EAAqB,SAArB,EAAgCE,OAAhC,CAAyCI,GAAD,IAAS;AAC/CF,EAAAA,OAAO,CAACG,IAAR,CAAaD,GAAb,EAAkB,MAAM;AACtBN,IAAAA,WAAW;AACXI,IAAAA,OAAO,CAACI,IAAR,CAAaJ,OAAO,CAACK,GAArB,EAA0BH,GAA1B;AACD,GAHD;AAID,CALD","sourcesContent":["// A simple interface to register functions to be called when the process exits.\n\nimport { noYieldsAllowed } from \"../utils/fiber-helpers.js\";\n\nconst exitHandlers = [];\n\nexport function onExit(func) {\n  exitHandlers.push(func);\n}\n\nfunction runHandlers() {\n  noYieldsAllowed(() => {\n    // Empty and execute all queued exit handlers.\n    exitHandlers.splice(0).forEach((f) => {\n      f();\n    });\n  });\n}\n\nprocess.on('exit', runHandlers);\n['SIGINT', 'SIGHUP', 'SIGTERM'].forEach((sig) => {\n  process.once(sig, () => {\n    runHandlers();\n    process.kill(process.pid, sig);\n  });\n});\n"],"file":"tools/tool-env/cleanup.js.map"}