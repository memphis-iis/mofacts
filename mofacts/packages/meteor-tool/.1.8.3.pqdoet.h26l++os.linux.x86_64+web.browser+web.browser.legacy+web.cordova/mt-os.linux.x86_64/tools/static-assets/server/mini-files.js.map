{"version":3,"sources":["tools/static-assets/server/mini-files.ts"],"names":[],"mappings":"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","sourcesContent":["import path from \"path\";\nimport { release, EOL } from \"os\";\n\n// All of these functions are attached to files.js for the tool;\n// they live here because we need them in boot.js as well to avoid duplicating\n// a lot of the code.\n//\n// Note that this file does NOT contain any of the \"perform I/O maybe\n// synchronously\" functions from files.js; this is intentional, because we want\n// to make it very hard to accidentally use fs.*Sync functions in the app server\n// after bootup (since they block all concurrency!)\n\n// Detect that we are on a Windows-like Filesystem, such as that in a WSL\n// (Windows Subsystem for Linux) even if it otherwise looks like we're on Unix.\n// https://github.com/Microsoft/BashOnWindows/issues/423#issuecomment-221627364\nexport function isWindowsLikeFilesystem() {\n  return process.platform === \"win32\" || release().indexOf(\"Microsoft\") >= 0;\n}\n\nexport function toPosixPath(p: string, partialPath: boolean = false) {\n  // Sometimes, you can have a path like \\Users\\IEUser on windows, and this\n  // actually means you want C:\\Users\\IEUser\n  if (p[0] === \"\\\\\" && (! partialPath)) {\n    p = process.env.SystemDrive + p;\n  }\n\n  p = p.replace(/\\\\/g, '/');\n  if (p[1] === ':' && ! partialPath) {\n    // transform \"C:/bla/bla\" to \"/c/bla/bla\"\n    p = '/' + p[0] + p.slice(2);\n  }\n\n  return p;\n}\n\nexport const convertToPosixPath = toPosixPath;\n\nexport function toDosPath(p: string, partialPath: boolean = false) {\n  if (p[0] === '/' && ! partialPath) {\n    if (! /^\\/[A-Za-z](\\/|$)/.test(p))\n      throw new Error(\"Surprising path: \" + p);\n    // transform a previously windows path back\n    // \"/C/something\" to \"c:/something\"\n    p = p[1] + \":\" + p.slice(2);\n  }\n\n  p = p.replace(/\\//g, '\\\\');\n  return p;\n}\n\nexport const convertToWindowsPath = toDosPath;\n\nexport function convertToOSPath(standardPath: string, partialPath: boolean = false) {\n  if (process.platform === \"win32\") {\n    return toDosPath(standardPath, partialPath);\n  }\n  return standardPath;\n}\n\nexport function convertToStandardPath(osPath: string, partialPath: boolean = false) {\n  if (process.platform === \"win32\") {\n    return toPosixPath(osPath, partialPath);\n  }\n  return osPath;\n}\n\nexport function convertToOSLineEndings(fileContents: string) {\n  return fileContents.replace(/\\n/g, EOL);\n}\n\nexport function convertToStandardLineEndings(fileContents: string) {\n  // Convert all kinds of end-of-line chars to linuxy \"\\n\".\n  return fileContents.replace(new RegExp(\"\\r\\n\", \"g\"), \"\\n\")\n                     .replace(new RegExp(\"\\r\", \"g\"), \"\\n\");\n}\n\n\n// Return the Unicode Normalization Form of the passed in path string, using\n// \"Normalization Form Canonical Composition\"\nexport function unicodeNormalizePath(path: string) {\n  return (path) ? path.normalize('NFC') : path;\n}\n\n// wrappings for path functions that always run as they were on unix (using\n// forward slashes)\nexport function wrapPathFunction<\n  TArgs extends any[],\n  TResult,\n  F extends (...args: TArgs) => TResult,\n>(\n  f: F,\n  partialPath: boolean = false,\n): F {\n  return function wrapper() {\n    if (process.platform === 'win32') {\n      const result = f.apply(path, Array.prototype.map.call(\n        arguments,\n        // if partialPaths is turned on (for path.join mostly)\n        // forget about conversion of absolute paths for Windows\n        p => toDosPath(p, partialPath),\n      ) as TArgs);\n\n      return typeof result === \"string\"\n        ? toPosixPath(result, partialPath)\n        : result;\n    }\n    return f.apply(path, arguments as any);\n  } as F;\n}\n\nexport const pathJoin = wrapPathFunction(path.join, true);\nexport const pathNormalize = wrapPathFunction(path.normalize);\nexport const pathRelative = wrapPathFunction(path.relative);\nexport const pathResolve = wrapPathFunction(path.resolve);\nexport const pathDirname = wrapPathFunction(path.dirname);\nexport const pathBasename = wrapPathFunction(path.basename);\nexport const pathExtname = wrapPathFunction(path.extname);\nexport const pathIsAbsolute = wrapPathFunction(path.isAbsolute);\nexport const pathSep = '/';\nexport const pathDelimiter = ':';\nexport const pathOsDelimiter = path.delimiter;\n"],"sourceRoot":"","file":"tools/static-assets/server/mini-files.js.map"}