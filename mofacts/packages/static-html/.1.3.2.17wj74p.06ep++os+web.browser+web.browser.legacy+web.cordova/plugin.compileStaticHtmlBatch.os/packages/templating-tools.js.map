{"version":3,"sources":["meteor://ðŸ’»app/packages/templating-tools/templating-tools.js","meteor://ðŸ’»app/packages/templating-tools/code-generation.js","meteor://ðŸ’»app/packages/templating-tools/compile-tags-with-spacebars.js","meteor://ðŸ’»app/packages/templating-tools/html-scanner.js","meteor://ðŸ’»app/packages/templating-tools/throw-compile-error.js"],"names":["module","export","TemplatingTools","scanHtmlForTags","link","v","compileTagsWithSpacebars","generateTemplateJS","generateBodyJS","CompileError","throwCompileError","module1","name","renderFuncCode","useHMR","nameLiteral","JSON","stringify","templateDotNameLiteral","_objectWithoutProperties","default","isEmpty","SpacebarsCompiler","tags","hmrAvailable","handler","SpacebarsTagCompiler","forEach","tag","addTagToResults","getResults","constructor","results","head","body","js","bodyAttrs","hasAttribs","attribs","tagName","contents","isReservedName","whitespace","compile","isTemplate","sourceName","addBodyAttrs","isBody","tagStartIndex","e","scanner","message","contentsStartIndex","offset","attrs","Object","keys","attr","val","hasOwnProperty","overrideIndex","options","scan","HtmlScan","getTags","tagNames","rest","index","tagNameRegex","join","openTagRegex","RegExp","advance","match","length","exec","matchToken","matchTokenTagName","matchTokenComment","matchTokenUnsupported","commentEnd","toLowerCase","tagAttribs","tagPartRegex","attrToken","attrKey","attrValue","end","tagContents","slice","m","trimmedContentsStartIndex","trimmedTagContents","fileContents","push","amount","substring","msg","finalIndex","err","file","line","split","throwBodyAttrsError","parseError"],"mappings":"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","file":"/packages/templating-tools.js","sourcesContent":["import { scanHtmlForTags } from './html-scanner';\nimport { compileTagsWithSpacebars } from './compile-tags-with-spacebars';\nimport { generateTemplateJS, generateBodyJS } from './code-generation'\nimport { CompileError, throwCompileError} from './throw-compile-error';\n\nexport const TemplatingTools  = {\n  scanHtmlForTags,\n  compileTagsWithSpacebars,\n  generateTemplateJS,\n  generateBodyJS,\n  CompileError,\n  throwCompileError\n};\n","export function generateTemplateJS(name, renderFuncCode, useHMR) {\n  const nameLiteral = JSON.stringify(name);\n  const templateDotNameLiteral = JSON.stringify(`Template.${name}`);\n\n  if (useHMR) {\n    // module.hot.data is used to make sure Template.__checkName can still\n    // detect duplicates\n    return `\nTemplate._migrateTemplate(\n  ${nameLiteral},\n  new Template(${templateDotNameLiteral}, ${renderFuncCode}),\n);\nif (typeof module === \"object\" && module.hot) {\n  module.hot.accept();\n  module.hot.dispose(function () {\n    Template.__pendingReplacement.push(${nameLiteral});\n    Template._applyHmrChanges(${nameLiteral});\n  });\n}\n`\n  }\n\n  return `\nTemplate.__checkName(${nameLiteral});\nTemplate[${nameLiteral}] = new Template(${templateDotNameLiteral}, ${renderFuncCode});\n`;\n}\n\nexport function generateBodyJS(renderFuncCode, useHMR) {\n  if (useHMR) {\n    return `\n(function () {\n  var renderFunc = ${renderFuncCode};\n  Template.body.addContent(renderFunc);\n  Meteor.startup(Template.body.renderToDocument);\n  if (typeof module === \"object\" && module.hot) {\n    module.hot.accept();\n    module.hot.dispose(function () {\n      var index = Template.body.contentRenderFuncs.indexOf(renderFunc)\n      Template.body.contentRenderFuncs.splice(index, 1);\n      Template._applyHmrChanges();\n    });\n  }\n})();\n`\n  }\n\n  return `\nTemplate.body.addContent(${renderFuncCode});\nMeteor.startup(Template.body.renderToDocument);\n`;\n}\n","import isEmpty from 'lodash.isempty';\nimport { SpacebarsCompiler } from 'meteor/spacebars-compiler';\nimport { generateBodyJS, generateTemplateJS } from './code-generation';\nimport { throwCompileError } from './throw-compile-error';\n\nexport function compileTagsWithSpacebars(tags, hmrAvailable) {\n  var handler = new SpacebarsTagCompiler();\n\n  tags.forEach((tag) => {\n    handler.addTagToResults(tag, hmrAvailable);\n  });\n\n  return handler.getResults();\n}\n\n\nclass SpacebarsTagCompiler {\n  constructor() {\n    this.results = {\n      head: '',\n      body: '',\n      js: '',\n      bodyAttrs: {}\n    };\n  }\n\n  getResults() {\n    return this.results;\n  }\n\n  addTagToResults(tag, hmrAvailable) {\n    this.tag = tag;\n\n    // do we have 1 or more attributes?\n    const hasAttribs = !isEmpty(this.tag.attribs);\n\n    if (this.tag.tagName === \"head\") {\n      if (hasAttribs) {\n        this.throwCompileError(\"Attributes on <head> not supported\");\n      }\n\n      this.results.head += this.tag.contents;\n      return;\n    }\n\n\n    // <body> or <template>\n\n    try {\n      if (this.tag.tagName === \"template\") {\n        const name = this.tag.attribs.name;\n\n        if (! name) {\n          this.throwCompileError(\"Template has no 'name' attribute\");\n        }\n\n        if (SpacebarsCompiler.isReservedName(name)) {\n          this.throwCompileError(`Template can't be named \"${name}\"`);\n        }\n\n        const whitespace = this.tag.attribs.whitespace || '';\n\n        const renderFuncCode = SpacebarsCompiler.compile(this.tag.contents, {\n          whitespace,\n          isTemplate: true,\n          sourceName: `Template \"${name}\"`\n        });\n\n        this.results.js += generateTemplateJS(\n          name, renderFuncCode, hmrAvailable);\n      } else if (this.tag.tagName === \"body\") {\n        const { whitespace = '', ...attribs } = this.tag.attribs;\n        this.addBodyAttrs(attribs);\n\n        const renderFuncCode = SpacebarsCompiler.compile(this.tag.contents, {\n          whitespace,\n          isBody: true,\n          sourceName: \"<body>\"\n        });\n\n        // We may be one of many `<body>` tags.\n        this.results.js += generateBodyJS(renderFuncCode, hmrAvailable);\n      } else {\n        this.throwCompileError(\"Expected <template>, <head>, or <body> tag in template file\", tagStartIndex);\n      }\n    } catch (e) {\n      if (e.scanner) {\n        // The error came from Spacebars\n        this.throwCompileError(e.message, this.tag.contentsStartIndex + e.offset);\n      } else {\n        throw e;\n      }\n    }\n  }\n\n  addBodyAttrs(attrs) {\n    Object.keys(attrs).forEach((attr) => {\n      const val = attrs[attr];\n\n      // This check is for conflicting body attributes in the same file;\n      // we check across multiple files in caching-html-compiler using the\n      // attributes on results.bodyAttrs\n      if (this.results.bodyAttrs.hasOwnProperty(attr) && this.results.bodyAttrs[attr] !== val) {\n        this.throwCompileError(\n          `<body> declarations have conflicting values for the '${attr}' attribute.`);\n      }\n\n      this.results.bodyAttrs[attr] = val;\n    });\n  }\n\n  throwCompileError(message, overrideIndex) {\n    throwCompileError(this.tag, message, overrideIndex);\n  }\n}\n","import { CompileError } from './throw-compile-error';\n\nexport function scanHtmlForTags(options) {\n  const scan = new HtmlScan(options);\n  return scan.getTags();\n}\n\n/**\n * Scan an HTML file for top-level tags and extract their contents. Pass them to\n * a tag handler (an object with a handleTag method)\n *\n * This is a primitive, regex-based scanner.  It scans\n * top-level tags, which are allowed to have attributes,\n * and ignores top-level HTML comments.\n */\nclass HtmlScan {\n  /**\n   * Initialize and run a scan of a single file\n   * @param  {String} sourceName The filename, used in errors only\n   * @param  {String} contents   The contents of the file\n   * @param  {String[]} tagNames An array of tag names that are accepted at the\n   * top level. If any other tag is encountered, an error is thrown.\n   */\n  constructor({\n        sourceName,\n        contents,\n        tagNames\n      }) {\n    this.sourceName = sourceName;\n    this.contents = contents;\n    this.tagNames = tagNames;\n\n    this.rest = contents;\n    this.index = 0;\n\n    this.tags = [];\n\n    const tagNameRegex = this.tagNames.join(\"|\");\n    const openTagRegex = new RegExp(`^((<(${tagNameRegex})\\\\b)|(<!--)|(<!DOCTYPE|{{!)|$)`, \"i\");\n\n    while (this.rest) {\n      // skip whitespace first (for better line numbers)\n      this.advance(this.rest.match(/^\\s*/)[0].length);\n\n      const match = openTagRegex.exec(this.rest);\n\n      if (! match) {\n        this.throwCompileError(`Expected one of: <${this.tagNames.join('>, <')}>`);\n      }\n\n      const matchToken = match[1];\n      const matchTokenTagName =  match[3];\n      const matchTokenComment = match[4];\n      const matchTokenUnsupported = match[5];\n\n      const tagStartIndex = this.index;\n      this.advance(match.index + match[0].length);\n\n      if (! matchToken) {\n        break; // matched $ (end of file)\n      }\n\n      if (matchTokenComment === '<!--') {\n        // top-level HTML comment\n        const commentEnd = /--\\s*>/.exec(this.rest);\n        if (! commentEnd)\n          this.throwCompileError(\"unclosed HTML comment in template file\");\n        this.advance(commentEnd.index + commentEnd[0].length);\n        continue;\n      }\n\n      if (matchTokenUnsupported) {\n        switch (matchTokenUnsupported.toLowerCase()) {\n        case '<!doctype':\n          this.throwCompileError(\n            \"Can't set DOCTYPE here.  (Meteor sets <!DOCTYPE html> for you)\");\n        case '{{!':\n          this.throwCompileError(\n            \"Can't use '{{! }}' outside a template.  Use '<!-- -->'.\");\n        }\n\n        this.throwCompileError();\n      }\n\n      // otherwise, a <tag>\n      const tagName = matchTokenTagName.toLowerCase();\n      const tagAttribs = {}; // bare name -> value dict\n      const tagPartRegex = /^\\s*((([a-zA-Z0-9:_-]+)\\s*=\\s*([\"'])(.*?)\\4)|(>))/;\n\n      // read attributes\n      let attr;\n      while ((attr = tagPartRegex.exec(this.rest))) {\n        const attrToken = attr[1];\n        const attrKey = attr[3];\n        let attrValue = attr[5];\n        this.advance(attr.index + attr[0].length);\n\n        if (attrToken === '>') {\n          break;\n        }\n\n        // XXX we don't HTML unescape the attribute value\n        // (e.g. to allow \"abcd&quot;efg\") or protect against\n        // collisions with methods of tagAttribs (e.g. for\n        // a property named toString)\n        attrValue = attrValue.match(/^\\s*([\\s\\S]*?)\\s*$/)[1]; // trim\n        tagAttribs[attrKey] = attrValue;\n      }\n\n      if (! attr) { // didn't end on '>'\n        this.throwCompileError(\"Parse error in tag\");\n      }\n\n      // find </tag>\n      const end = (new RegExp('</'+tagName+'\\\\s*>', 'i')).exec(this.rest);\n      if (! end) {\n        this.throwCompileError(\"unclosed <\"+tagName+\">\");\n      }\n\n      const tagContents = this.rest.slice(0, end.index);\n      const contentsStartIndex = this.index;\n\n      // trim the tag contents.\n      // this is a courtesy and is also relied on by some unit tests.\n      var m = tagContents.match(/^([ \\t\\r\\n]*)([\\s\\S]*?)[ \\t\\r\\n]*$/);\n      const trimmedContentsStartIndex = contentsStartIndex + m[1].length;\n      const trimmedTagContents = m[2];\n\n      const tag = {\n        tagName: tagName,\n        attribs: tagAttribs,\n        contents: trimmedTagContents,\n        contentsStartIndex: trimmedContentsStartIndex,\n        tagStartIndex: tagStartIndex,\n        fileContents: this.contents,\n        sourceName: this.sourceName\n      };\n\n      // save the tag\n      this.tags.push(tag);\n\n      // advance afterwards, so that line numbers in errors are correct\n      this.advance(end.index + end[0].length);\n    }\n  }\n\n  /**\n   * Advance the parser\n   * @param  {Number} amount The amount of characters to advance\n   */\n  advance(amount) {\n    this.rest = this.rest.substring(amount);\n    this.index += amount;\n  }\n\n  throwCompileError(msg, overrideIndex) {\n    const finalIndex = (typeof overrideIndex === 'number' ? overrideIndex : this.index);\n\n    const err = new CompileError();\n    err.message = msg || \"bad formatting in template file\";\n    err.file = this.sourceName;\n    err.line = this.contents.substring(0, finalIndex).split('\\n').length;\n\n    throw err;\n  }\n\n  throwBodyAttrsError(msg) {\n    this.parseError(msg);\n  }\n\n  getTags() {\n    return this.tags;\n  }\n}\n","export class CompileError {}\n\nexport function throwCompileError(tag, message, overrideIndex) {\n  const finalIndex = (typeof overrideIndex === 'number' ?\n    overrideIndex : tag.tagStartIndex);\n\n  const err = new CompileError();\n  err.message = message || \"bad formatting in template file\";\n  err.file = tag.sourceName;\n  err.line = tag.fileContents.substring(0, finalIndex).split('\\n').length;\n  throw err;\n}\n"]}